<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<head>
    <title>KOReader Documentation</title>
    <link rel="stylesheet" href="../ldoc_fixed.css" type="text/css" />
</head>
<body>

<div id="container">

<div id="product">
	<div id="product_logo"></div>
	<div id="product_name"><big><b></b></big></div>
	<div id="product_description"></div>
</div> <!-- id="product" -->


<div id="main">


<!-- Menu -->

<div id="navigation">
<br/>
<h1>KOReader</h1>


<ul>
  <li><a href="../index.html">Index</a></li>
</ul>

<h2>Contents</h2>
<ul>
<li><a href="#Functions">Functions</a></li>
<li><a href="#Issues">Issues</a></li>
</ul>


<h2>Modules</h2>
<ul class="nowrap">
  <li><a href="../modules/android.html">android</a></li>
  <li><a href="../modules/apps.filemanager.filemanagerbookinfo.html">apps.filemanager.filemanagerbookinfo</a></li>
  <li><a href="../modules/apps.filemanager.filemanagerconverter.html">apps.filemanager.filemanagerconverter</a></li>
  <li><a href="../modules/apps.filemanager.filemanagerutil.html">apps.filemanager.filemanagerutil</a></li>
  <li><a href="../modules/apps.filemanager.lib.md.html">apps.filemanager.lib.md</a></li>
  <li><a href="../modules/apps.reader.modules.readerlink.html">apps.reader.modules.readerlink</a></li>
  <li><a href="../modules/apps.reader.modules.readerview.html">apps.reader.modules.readerview</a></li>
  <li><a href="../modules/apps.reader.readerui.html">apps.reader.readerui</a></li>
  <li><a href="../modules/baseexporter.html">baseexporter</a></li>
  <li><a href="../modules/cache.html">cache</a></li>
  <li><a href="../modules/cacheitem.html">cacheitem</a></li>
  <li><a href="../modules/datetime.html">datetime</a></li>
  <li><a href="../modules/dbg.html">dbg</a></li>
  <li><a href="../modules/depgraph.html">depgraph</a></li>
  <li><a href="../modules/device.generic.device.html">device.generic.device</a></li>
  <li><a href="../modules/device.gesturedetector.html">device.gesturedetector</a></li>
  <li><a href="../modules/device.input.html">device.input</a></li>
  <li><a href="../modules/device.kindle.mockrtc.html">device.kindle.mockrtc</a></li>
  <li><a href="../modules/device.kobo.nickel_conf.html">device.kobo.nickel_conf</a></li>
  <li><a href="../modules/device.sysfs_light.html">device.sysfs_light</a></li>
  <li><a href="../modules/device.wakeupmgr.html">device.wakeupmgr</a></li>
  <li><a href="../modules/dispatcher.html">dispatcher</a></li>
  <li><a href="../modules/docsettings.html">docsettings</a></li>
  <li><a href="../modules/document.doccache.html">document.doccache</a></li>
  <li><a href="../modules/document.documentregistry.html">document.documentregistry</a></li>
  <li><a href="../modules/document.koptinterface.html">document.koptinterface</a></li>
  <li><a href="../modules/dump.html">dump</a></li>
  <li><a href="../modules/ffi.blitbuffer.html">ffi.blitbuffer</a></li>
  <li><a href="../modules/ffi.crypto.html">ffi.crypto</a></li>
  <li><a href="../modules/ffi.framebuffer.html">ffi.framebuffer</a></li>
  <li><a href="../modules/ffi.freetype.html">ffi.freetype</a></li>
  <li><a href="../modules/ffi.jpeg.html">ffi.jpeg</a></li>
  <li><a href="../modules/ffi.koptcontext.html">ffi.koptcontext</a></li>
  <li><a href="../modules/ffi.loadlib.html">ffi.loadlib</a></li>
  <li><a href="../modules/ffi.md5.html">ffi.md5</a></li>
  <li><a href="../modules/ffi.mupdf.html">ffi.mupdf</a></li>
  <li><a href="../modules/ffi.png.html">ffi.png</a></li>
  <li><a href="../modules/ffi.rtc.html">ffi.rtc</a></li>
  <li><a href="../modules/ffi.sdl2_0.html">ffi.sdl2_0</a></li>
  <li><a href="../modules/ffi.utf8proc.html">ffi.utf8proc</a></li>
  <li><a href="../modules/ffi.util.html">ffi.util</a></li>
  <li><a href="../modules/ffi.webp.html">ffi.webp</a></li>
  <li><a href="../modules/ffi.zipwriter.html">ffi.zipwriter</a></li>
  <li><a href="../modules/ffi.zlib.html">ffi.zlib</a></li>
  <li><a href="../modules/ffi.zstd.html">ffi.zstd</a></li>
  <li><a href="../modules/gettext.html">gettext</a></li>
  <li><a href="../modules/koplugin.HelloWorld.html">koplugin.HelloWorld</a></li>
  <li><a href="../modules/koplugin.QRClipboard.html">koplugin.QRClipboard</a></li>
  <li><a href="../modules/koplugin.autodim.html">koplugin.autodim</a></li>
  <li><a href="../modules/koplugin.autowarmth.html">koplugin.autowarmth</a></li>
  <li><a href="../modules/koplugin.calibre.metadata.html">koplugin.calibre.metadata</a></li>
  <li><a href="../modules/koplugin.coverimage.html">koplugin.coverimage</a></li>
  <li><a href="../modules/koplugin.exporter.html">koplugin.exporter</a></li>
  <li><a href="../modules/koplugin.japanese.html">koplugin.japanese</a></li>
  <li><a href="../modules/koplugin.japanese.deinflector.html">koplugin.japanese.deinflector</a></li>
  <li><a href="../modules/koplugin.patchmanagement.html">koplugin.patchmanagement</a></li>
  <li><a href="../modules/koplugin.terminal.html">koplugin.terminal</a></li>
  <li><a href="../modules/koplugin.terminal.html">koplugin.terminal</a></li>
  <li><a href="../modules/koplugin.vocabbuilder.html">koplugin.vocabbuilder</a></li>
  <li><a href="../modules/koplugin.wallabag.html">koplugin.wallabag</a></li>
  <li><a href="../modules/languagesupport.html">languagesupport</a></li>
  <li><a href="../modules/logger.html">logger</a></li>
  <li><a href="../modules/luadata.html">luadata</a></li>
  <li><a href="../modules/luadefaults.html">luadefaults</a></li>
  <li><a href="../modules/luasettings.html">luasettings</a></li>
  <li><a href="../modules/optmath.html">optmath</a></li>
  <li><a href="../modules/random.html">random</a></li>
  <li><a href="../modules/socketutil.html">socketutil</a></li>
  <li><a href="../modules/sort.html">sort</a></li>
  <li><a href="../modules/suntime.html">suntime</a></li>
  <li><a href="../modules/time.html">time</a></li>
  <li><a href="../modules/ui.bidi.html">ui.bidi</a></li>
  <li><a href="../modules/ui.data.css_tweaks.html">ui.data.css_tweaks</a></li>
  <li><a href="../modules/ui.data.keyboardlayouts.generic_ime.html">ui.data.keyboardlayouts.generic_ime</a></li>
  <li><a href="../modules/ui.data.keyboardlayouts.ja_keyboard.html">ui.data.keyboardlayouts.ja_keyboard</a></li>
  <li><a href="../modules/ui.data.keyboardlayouts.ja_keyboard_keys.html">ui.data.keyboardlayouts.ja_keyboard_keys</a></li>
  <li><a href="../modules/ui.data.keyboardlayouts.ko_KR_helper.html">ui.data.keyboardlayouts.ko_KR_helper</a></li>
  <li><a href="../modules/ui.data.keyboardlayouts.zh_keyboard.html">ui.data.keyboardlayouts.zh_keyboard</a></li>
  <li><a href="../modules/ui.data.optionsutil.html">ui.data.optionsutil</a></li>
  <li><a href="../modules/ui.downloadmgr.html">ui.downloadmgr</a></li>
  <li><a href="../modules/ui.event.html">ui.event</a></li>
  <li><a href="../modules/ui.font.html">ui.font</a></li>
  <li><a href="../modules/ui.geometry.html">ui.geometry</a></li>
  <li><a href="../modules/ui.hook_container.html">ui.hook_container</a></li>
  <li><a href="../modules/ui.menusorter.html">ui.menusorter</a></li>
  <li><a href="../modules/ui.network.wpa_supplicant.html">ui.network.wpa_supplicant</a></li>
  <li><a href="../modules/ui.otamanager.html">ui.otamanager</a></li>
  <li><a href="../modules/ui.plugin.background_task_plugin.html">ui.plugin.background_task_plugin</a></li>
  <li><a href="../modules/ui.plugin.switch_plugin.html">ui.plugin.switch_plugin</a></li>
  <li><a href="../modules/ui.quickstart.html">ui.quickstart</a></li>
  <li><a href="../modules/ui.renderimage.html">ui.renderimage</a></li>
  <li><a href="../modules/ui.rendertext.html">ui.rendertext</a></li>
  <li><a href="../modules/ui.size.html">ui.size</a></li>
  <li><a href="../modules/ui.translator.html">ui.translator</a></li>
  <li><a href="../modules/ui.trapper.html">ui.trapper</a></li>
  <li><strong>ui.uimanager</strong></li>
  <li><a href="../modules/ui.viewhtml.html">ui.viewhtml</a></li>
  <li><a href="../modules/ui.widget.bboxwidget.html">ui.widget.bboxwidget</a></li>
  <li><a href="../modules/ui.widget.button.html">ui.widget.button</a></li>
  <li><a href="../modules/ui.widget.buttondialog.html">ui.widget.buttondialog</a></li>
  <li><a href="../modules/ui.widget.checkbutton.html">ui.widget.checkbutton</a></li>
  <li><a href="../modules/ui.widget.checkmark.html">ui.widget.checkmark</a></li>
  <li><a href="../modules/ui.widget.confirmbox.html">ui.widget.confirmbox</a></li>
  <li><a href="../modules/ui.widget.container.alphacontainer.html">ui.widget.container.alphacontainer</a></li>
  <li><a href="../modules/ui.widget.container.bottomcontainer.html">ui.widget.container.bottomcontainer</a></li>
  <li><a href="../modules/ui.widget.container.centercontainer.html">ui.widget.container.centercontainer</a></li>
  <li><a href="../modules/ui.widget.container.framecontainer.html">ui.widget.container.framecontainer</a></li>
  <li><a href="../modules/ui.widget.container.inputcontainer.html">ui.widget.container.inputcontainer</a></li>
  <li><a href="../modules/ui.widget.container.leftcontainer.html">ui.widget.container.leftcontainer</a></li>
  <li><a href="../modules/ui.widget.container.movablecontainer.html">ui.widget.container.movablecontainer</a></li>
  <li><a href="../modules/ui.widget.container.rightcontainer.html">ui.widget.container.rightcontainer</a></li>
  <li><a href="../modules/ui.widget.container.scrollablecontainer.html">ui.widget.container.scrollablecontainer</a></li>
  <li><a href="../modules/ui.widget.container.topcontainer.html">ui.widget.container.topcontainer</a></li>
  <li><a href="../modules/ui.widget.container.underlinecontainer.html">ui.widget.container.underlinecontainer</a></li>
  <li><a href="../modules/ui.widget.container.widgetcontainer.html">ui.widget.container.widgetcontainer</a></li>
  <li><a href="../modules/ui.widget.datetimewidget.html">ui.widget.datetimewidget</a></li>
  <li><a href="../modules/ui.widget.eventlistener.html">ui.widget.eventlistener</a></li>
  <li><a href="../modules/ui.widget.horizontalgroup.html">ui.widget.horizontalgroup</a></li>
  <li><a href="../modules/ui.widget.htmlboxwidget.html">ui.widget.htmlboxwidget</a></li>
  <li><a href="../modules/ui.widget.iconbutton.html">ui.widget.iconbutton</a></li>
  <li><a href="../modules/ui.widget.iconwidget.html">ui.widget.iconwidget</a></li>
  <li><a href="../modules/ui.widget.imageviewer.html">ui.widget.imageviewer</a></li>
  <li><a href="../modules/ui.widget.imagewidget.html">ui.widget.imagewidget</a></li>
  <li><a href="../modules/ui.widget.infomessage.html">ui.widget.infomessage</a></li>
  <li><a href="../modules/ui.widget.inputdialog.html">ui.widget.inputdialog</a></li>
  <li><a href="../modules/ui.widget.keyboardlayoutdialog.html">ui.widget.keyboardlayoutdialog</a></li>
  <li><a href="../modules/ui.widget.keyvaluepage.html">ui.widget.keyvaluepage</a></li>
  <li><a href="../modules/ui.widget.linewidget.html">ui.widget.linewidget</a></li>
  <li><a href="../modules/ui.widget.listview.html">ui.widget.listview</a></li>
  <li><a href="../modules/ui.widget.multiconfirmbox.html">ui.widget.multiconfirmbox</a></li>
  <li><a href="../modules/ui.widget.multiinputdialog.html">ui.widget.multiinputdialog</a></li>
  <li><a href="../modules/ui.widget.networksetting.html">ui.widget.networksetting</a></li>
  <li><a href="../modules/ui.widget.notification.html">ui.widget.notification</a></li>
  <li><a href="../modules/ui.widget.numberpickerwidget.html">ui.widget.numberpickerwidget</a></li>
  <li><a href="../modules/ui.widget.openwithdialog.html">ui.widget.openwithdialog</a></li>
  <li><a href="../modules/ui.widget.overlapgroup.html">ui.widget.overlapgroup</a></li>
  <li><a href="../modules/ui.widget.progresswidget.html">ui.widget.progresswidget</a></li>
  <li><a href="../modules/ui.widget.qrmessage.html">ui.widget.qrmessage</a></li>
  <li><a href="../modules/ui.widget.radiobuttontable.html">ui.widget.radiobuttontable</a></li>
  <li><a href="../modules/ui.widget.radiobuttonwidget.html">ui.widget.radiobuttonwidget</a></li>
  <li><a href="../modules/ui.widget.scrollhtmlwidget.html">ui.widget.scrollhtmlwidget</a></li>
  <li><a href="../modules/ui.widget.scrolltextwidget.html">ui.widget.scrolltextwidget</a></li>
  <li><a href="../modules/ui.widget.textboxwidget.html">ui.widget.textboxwidget</a></li>
  <li><a href="../modules/ui.widget.textviewer.html">ui.widget.textviewer</a></li>
  <li><a href="../modules/ui.widget.textwidget.html">ui.widget.textwidget</a></li>
  <li><a href="../modules/ui.widget.toggleswitch.html">ui.widget.toggleswitch</a></li>
  <li><a href="../modules/ui.widget.touchmenu.html">ui.widget.touchmenu</a></li>
  <li><a href="../modules/ui.widget.trapwidget.html">ui.widget.trapwidget</a></li>
  <li><a href="../modules/ui.widget.verticalgroup.html">ui.widget.verticalgroup</a></li>
  <li><a href="../modules/ui.widget.widget.html">ui.widget.widget</a></li>
  <li><a href="../modules/userpatch.html">userpatch</a></li>
  <li><a href="../modules/util.html">util</a></li>
  <li><a href="../modules/version.html">version</a></li>
</ul>
<h2>Topics</h2>
<ul class="">
  <li><a href="../topics/Collaborating_with_Git.md.html">Collaborating with Git</a></li>
  <li><a href="../topics/DataStore.md.html">DataStore</a></li>
  <li><a href="../topics/Development_guide.md.html">Development Guide</a></li>
  <li><a href="../topics/Events.md.html">Events</a></li>
  <li><a href="../topics/Hacking.md.html">Hacking</a></li>
  <li><a href="../topics/Porting.md.html">Porting</a></li>
  <li><a href="../topics/README.md.html">README</a></li>
  <li><a href="../topics/Unit_tests.md.html">Unit Tests</a></li>
</ul>

</div>

<div id="content">

<h1>Module <code>ui.uimanager</code></h1>
<p>This module manages widgets.</p>
<p>

</p>


<h2><a href="#Functions">Functions</a></h2>
<table class="function_list">
	<tr>
	<td class="name" nowrap><a href="#UIManager:show">UIManager:show (widget, refreshtype, refreshregion, x, y, refreshdither)</a></td>
	<td class="summary">Registers and shows a widget.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#UIManager:close">UIManager:close (widget, refreshtype, refreshregion, refreshdither)</a></td>
	<td class="summary">Unregisters a widget.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#UIManager:shiftScheduledTasksBy">UIManager:shiftScheduledTasksBy (time)</a></td>
	<td class="summary">Shift the execution times of all scheduled tasks.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#UIManager:scheduleIn">UIManager:scheduleIn (seconds, action, ...)</a></td>
	<td class="summary">Schedules a task to be run a certain amount of seconds from now.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#UIManager:nextTick">UIManager:nextTick (action, ...)</a></td>
	<td class="summary">Schedules a task for the next UI tick.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#UIManager:tickAfterNext">UIManager:tickAfterNext (action, ...)</a></td>
	<td class="summary">Schedules a task to be run two UI ticks from now.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#UIManager:unschedule">UIManager:unschedule (action)</a></td>
	<td class="summary">Unschedules a previously scheduled task.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#UIManager:setDirty">UIManager:setDirty (widget, refreshtype, refreshregion, refreshdither)</a></td>
	<td class="summary">Mark a window-level widget as dirty, enqueuing a repaint &amp; refresh request for that widget, to be processed on the next UI tick.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#UIManager:clearRenderStack">UIManager:clearRenderStack ()</a></td>
	<td class="summary">Clear the full repaint &amp; refresh queues.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#UIManager:setRefreshRate">UIManager:setRefreshRate (rate, night_rate)</a></td>
	<td class="summary">Sets the full refresh rate for e-ink screens (<code>FULL_REFRESH_COUNT</code>).</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#UIManager:getRefreshRate">UIManager:getRefreshRate ()</a></td>
	<td class="summary">Returns the full refresh rate for e-ink screens (<code>FULL_REFRESH_COUNT</code>).</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#UIManager:ToggleNightMode">UIManager:ToggleNightMode (night_mode)</a></td>
	<td class="summary">Toggles Night Mode (i.e., inverted rendering).</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#UIManager:getNthTopWidget">UIManager:getNthTopWidget (n)</a></td>
	<td class="summary">Get n.th topmost widget</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#UIManager:topdown_widgets_iter">UIManager:topdown_widgets_iter ()</a></td>
	<td class="summary">
<p>Top-to-bottom widgets iterator
 NOTE: VirtualKeyboard can be instantiated multiple times, and is a modal,</p>
<pre><code>    so don't be surprised if you find a couple of instances of it at the top ;).
</code></pre>
</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#UIManager:getTopmostVisibleWidget">UIManager:getTopmostVisibleWidget ()</a></td>
	<td class="summary">Get the topmost visible widget</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#UIManager:isSubwidgetShown">UIManager:isSubwidgetShown (widget, max_depth)</a></td>
	<td class="summary">Check if a widget is still in the window stack, or is a subwidget of a widget still in the window stack.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#UIManager:isWidgetShown">UIManager:isWidgetShown (widget)</a></td>
	<td class="summary">Same as <a href="../modules/ui.uimanager.html#UIManager:isSubwidgetShown">isSubwidgetShown</a>, but only check window-level widgets (e.g., what's directly registered in the window stack), don't recurse.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#UIManager:quit">UIManager:quit (exit_code, implicit)</a></td>
	<td class="summary">Signals to quit.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#UIManager:sendEvent">UIManager:sendEvent (event)</a></td>
	<td class="summary">Transmits an <a href="../modules/ui.event.html#Event">Event</a> to active widgets, top to bottom.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#UIManager:broadcastEvent">UIManager:broadcastEvent (event)</a></td>
	<td class="summary">Transmits an <a href="../modules/ui.event.html#Event">Event</a> to all registered widgets.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#UIManager:getTime">UIManager:getTime ()</a></td>
	<td class="summary">Returns a time (fts) corresponding to the last tick.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#UIManager:getElapsedTimeSinceBoot">UIManager:getElapsedTimeSinceBoot ()</a></td>
	<td class="summary">Returns a time (fts) corresponding to the last UI tick plus the time in standby.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#UIManager:forceRePaint">UIManager:forceRePaint ()</a></td>
	<td class="summary">Explicitly drain the paint &amp; refresh queues <em>now</em>, instead of waiting for the next UI tick.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#UIManager:waitForVSync">UIManager:waitForVSync ()</a></td>
	<td class="summary">Ask the EPDC to <em>block</em> until our previous refresh ioctl has completed.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#UIManager:yieldToEPDC">UIManager:yieldToEPDC (sleep_us)</a></td>
	<td class="summary">Yield to the EPDC.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#UIManager:widgetRepaint">UIManager:widgetRepaint (widget, x, y)</a></td>
	<td class="summary">Used to repaint a specific sub-widget that isn't on the <code>_window_stack</code> itself.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#UIManager:widgetInvert">UIManager:widgetInvert (widget, x, y, w, h)</a></td>
	<td class="summary">Same idea as <a href="../modules/ui.uimanager.html#UIManager:widgetRepaint">widgetRepaint</a>, but does a simple <code>bb:invertRect</code> on the Screen buffer, without actually going through the widget's <code>paintTo</code> method.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#UIManager:run">UIManager:run ()</a></td>
	<td class="summary">This is the main loop of the UI controller.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#UIManager:suspend">UIManager:suspend ()</a></td>
	<td class="summary">Executes all the operations of a suspension (i.e., sleep) request.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#UIManager:allowStandby">UIManager:allowStandby ()</a></td>
	<td class="summary">Release standby lock.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#UIManager:preventStandby">UIManager:preventStandby ()</a></td>
	<td class="summary">Prevent standby.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#UIManager:flushSettings">UIManager:flushSettings ()</a></td>
	<td class="summary">Broadcasts a <code>FlushSettings</code> Event to <em>all</em> widgets.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#UIManager:restartKOReader">UIManager:restartKOReader ()</a></td>
	<td class="summary">Sanely restart KOReader (on supported platforms).</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#UIManager:abort">UIManager:abort ()</a></td>
	<td class="summary">Sanely abort KOReader (e.g., exit sanely, but with a non-zero return code).</td>
	</tr>
</table>
<h2><a href="#Issues">Issues</a></h2>
<table class="function_list">
	<tr>
	<td class="name" nowrap><a href="#UIManager:widgetInvert-fixme7">UIManager:widgetInvert-fixme7</a></td>
	<td class="summary">Force close looper when there is unhandled error,
 otherwise the looper will hang. Any better solution?</td>
	</tr>
</table>

<br/>
<br/>


    <h2 class="section-header "><a name="Functions"></a>Functions</h2>

    <dl class="function">
    <dt>
    <a name = "UIManager:show"></a>
    <strong>UIManager:show (widget, refreshtype, refreshregion, x, y, refreshdither)</strong>
    </dt>
    <dd>
    Registers and shows a widget. </p>

<p>Widgets are registered in a stack, from bottom to top in registration order,
with a few tweaks to handle modals &amp; toasts:
toast widgets are stacked together on top,
then modal widgets are stacked together, and finally come standard widgets.</p>

<p>If you think about how painting will be handled (also bottom to top), this makes perfect sense ;).</p>

<p>For more details about refreshtype, refreshregion &amp; refreshdither see the description of <a href="../modules/ui.uimanager.html#UIManager:setDirty">setDirty</a>.
If refreshtype is omitted, no refresh will be enqueued at this time.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">widget</span>
         a <a href="../modules/ui.widget.widget.html#">widget</a> object
        </li>
        <li><span class="parameter">refreshtype</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         <code>&quot;full&quot;</code>, <code>&quot;flashpartial&quot;</code>, <code>&quot;flashui&quot;</code>, <code>&quot;[partial]&quot;</code>, <code>&quot;[ui]&quot;</code>, <code>&quot;partial&quot;</code>, <code>&quot;ui&quot;</code>, <code>&quot;fast&quot;</code>, <code>&quot;a2&quot;</code> (optional)
        </li>
        <li><span class="parameter">refreshregion</span>
         a rectangle <a href="../modules/ui.geometry.html#Geom">Geom</a> object (optional, requires refreshtype to be set)
        </li>
        <li><span class="parameter">x</span>
            <span class="types"><span class="type">integer</span></span>
         horizontal screen offset (optional, <code>0</code> if omitted)
        </li>
        <li><span class="parameter">y</span>
            <span class="types"><span class="type">integer</span></span>
         vertical screen offset (optional, <code>0</code> if omitted)
        </li>
        <li><span class="parameter">refreshdither</span>
            <span class="types"><span class="type">boolean</span></span>
         <code>true</code> if widget requires dithering (optional, requires refreshtype to be set)
        </li>
    </ul>



    <h3>See also:</h3>
    <ul>
         <a href="../modules/ui.uimanager.html#UIManager:setDirty">setDirty</a>
    </ul>


</dd>
    <dt>
    <a name = "UIManager:close"></a>
    <strong>UIManager:close (widget, refreshtype, refreshregion, refreshdither)</strong>
    </dt>
    <dd>
    Unregisters a widget. </p>

<p>It will be removed from the stack.
Will flag uncovered widgets as dirty.</p>

<p>For more details about refreshtype, refreshregion &amp; refreshdither see the description of <a href="../modules/ui.uimanager.html#UIManager:setDirty">setDirty</a>.
If refreshtype is omitted, no extra refresh will be enqueued at this time, leaving only those from the uncovered widgets.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">widget</span>
         a <a href="../modules/ui.widget.widget.html#">widget</a> object
        </li>
        <li><span class="parameter">refreshtype</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         <code>&quot;full&quot;</code>, <code>&quot;flashpartial&quot;</code>, <code>&quot;flashui&quot;</code>, <code>&quot;[partial]&quot;</code>, <code>&quot;[ui]&quot;</code>, <code>&quot;partial&quot;</code>, <code>&quot;ui&quot;</code>, <code>&quot;fast&quot;</code>, <code>&quot;a2&quot;</code> (optional)
        </li>
        <li><span class="parameter">refreshregion</span>
         a rectangle <a href="../modules/ui.geometry.html#Geom">Geom</a> object (optional, requires refreshtype to be set)
        </li>
        <li><span class="parameter">refreshdither</span>
            <span class="types"><span class="type">boolean</span></span>
         <code>true</code> if the refresh requires dithering (optional, requires refreshtype to be set)
        </li>
    </ul>



    <h3>See also:</h3>
    <ul>
         <a href="../modules/ui.uimanager.html#UIManager:setDirty">setDirty</a>
    </ul>


</dd>
    <dt>
    <a name = "UIManager:shiftScheduledTasksBy"></a>
    <strong>UIManager:shiftScheduledTasksBy (time)</strong>
    </dt>
    <dd>
    Shift the execution times of all scheduled tasks.
 UIManager uses CLOCK_MONOTONIC (which doesn't tick during standby), so shifting the execution
 time by a negative value will lead to an execution at the expected time.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">time</span>
         if positive execute the tasks later, if negative they should be executed earlier
        </li>
    </ul>





</dd>
    <dt>
    <a name = "UIManager:scheduleIn"></a>
    <strong>UIManager:scheduleIn (seconds, action, ...)</strong>
    </dt>
    <dd>
    Schedules a task to be run a certain amount of seconds from now.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">seconds</span>
            <span class="types"><span class="type">number</span></span>
         scheduling delay in seconds (supports decimal values, 1ms resolution).
        </li>
        <li><span class="parameter">action</span>
            <span class="types"><span class="type">function</span></span>
         reference to the task to be scheduled (may be anonymous)
        </li>
        <li><span class="parameter">...</span>
         optional arguments passed to action
        </li>
    </ul>



    <h3>See also:</h3>
    <ul>
         <a href="../modules/ui.uimanager.html#UIManager:unschedule">unschedule</a>
    </ul>


</dd>
    <dt>
    <a name = "UIManager:nextTick"></a>
    <strong>UIManager:nextTick (action, ...)</strong>
    </dt>
    <dd>
    Schedules a task for the next UI tick.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">action</span>
            <span class="types"><span class="type">function</span></span>
         reference to the task to be scheduled (may be anonymous)
        </li>
        <li><span class="parameter">...</span>
         optional arguments passed to action
        </li>
    </ul>



    <h3>See also:</h3>
    <ul>
         <a href="../modules/ui.uimanager.html#UIManager:scheduleIn">scheduleIn</a>
    </ul>


</dd>
    <dt>
    <a name = "UIManager:tickAfterNext"></a>
    <strong>UIManager:tickAfterNext (action, ...)</strong>
    </dt>
    <dd>
    Schedules a task to be run two UI ticks from now. </p>

<p>Useful to run UI callbacks ASAP without skipping repaints.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">action</span>
            <span class="types"><span class="type">function</span></span>
         reference to the task to be scheduled (may be anonymous)
        </li>
        <li><span class="parameter">...</span>
         optional arguments passed to action
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

        A reference to the initial nextTick wrapper function,
necessary if the caller wants to unschedule action <em>before</em> it actually gets inserted in the task queue by nextTick.
    </ol>


    <h3>See also:</h3>
    <ul>
         <a href="../modules/ui.uimanager.html#UIManager:nextTick">nextTick</a>
    </ul>


</dd>
    <dt>
    <a name = "UIManager:unschedule"></a>
    <strong>UIManager:unschedule (action)</strong>
    </dt>
    <dd>
    Unschedules a previously scheduled task. </p>

<p>In order to unschedule anonymous functions, store a reference.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">action</span>
            <span class="types"><span class="type">function</span></span>



        </li>
    </ul>



    <h3>See also:</h3>
    <ul>
         <a href="../modules/ui.uimanager.html#UIManager:scheduleIn">scheduleIn</a>
    </ul>

    <h3>Usage:</h3>
    <ul>
        <pre class="example">self.anonymousFunction = <span class="keyword">function</span>() self:<span class="function-name">regularFunction</span>() <span class="keyword">end</span>
UIManager:<span class="function-name">scheduleIn</span>(<span class="number">10.5</span>, self.anonymousFunction)
UIManager:<span class="function-name">unschedule</span>(self.anonymousFunction)</pre>
    </ul>

</dd>
    <dt>
    <a name = "UIManager:setDirty"></a>
    <strong>UIManager:setDirty (widget, refreshtype, refreshregion, refreshdither)</strong>
    </dt>
    <dd>
    Mark a window-level widget as dirty, enqueuing a repaint &amp; refresh request for that widget, to be processed on the next UI tick. </p>

<p>The second parameter (refreshtype) can either specify a refreshtype
(optionally in combination with a refreshregion - which is suggested,
and an even more optional refreshdither flag if the content requires dithering);
or a function that returns a refreshtype, refreshregion tuple (or a refreshtype, refreshregion, refreshdither triple),
which will be called <em>after</em> painting the widget.
This is an interesting distinction, because a widget's geometry,
usually stored in a field named <code>dimen</code>, is (generally) only computed at painting time (e.g., during <code>paintTo</code>).
The TL;DR being: if you already know the region, you can pass everything by value directly,
(it'll make for slightly more readable debug logs),
but if the region will only be known after the widget has been painted, pass a function.
Note that, technically, it means that stuff passed by value will be enqueued earlier in the refresh stack.
In practice, since the stack of (both types of) refreshes is optimized into as few actual refresh ioctls as possible,
and that during the next <code>_repaint</code> tick (which is when <code>paintTo</code> for dirty widgets happens),
this shouldn't change much in the grand scheme of things, but it ought to be noted ;).</p>

<p>See <code>_repaint</code> for more details about how the repaint &amp; refresh queues are processed,
and <code>handleInput</code> for more details about when those queues are actually drained.
What you should essentially remember is that <a href="../modules/ui.uimanager.html#UIManager:setDirty">setDirty</a> doesn't actually "do" anything visible on its own.
It doesn't block, and when it returns, nothing new has actually been painted or refreshed.
It just appends stuff to the paint and/or refresh queues.</p>

<p>Here's a quick rundown of what each refreshtype should be used for:</p>

<ul>
    <li><code>full</code>: high-fidelity flashing refresh (e.g., large images).
          Highest quality, but highest latency.
          Don't abuse if you only want a flash (in this case, prefer <code>flashui</code> or <code>flashpartial</code>).</li>
    <li><code>partial</code>: medium fidelity refresh (e.g., text on a white background).
             Can be promoted to flashing after <code>FULL\_REFRESH\_COUNT</code> refreshes.
             Don't abuse to avoid spurious flashes.
             In practice, this means this should mostly always be limited to ReaderUI.</li>
    <li><code>[partial]</code>: variant of partial that asks the driver not to merge this update with surrounding ones.
               Equivalent to partial on platforms where this distinction is not implemented.</li>
    <li><code>ui</code>: medium fidelity refresh (e.g., mixed content).
        Should apply to most UI elements.
        When in doubt, use this.</li>
    <li><code>[ui]</code>: variant of ui that asks the driver not to merge this update with surrounding ones.
          Equivalent to ui on platforms where this distinction is not implemented.</li>
    <li><code>fast</code>: low fidelity refresh (e.g., monochrome content (technically, from any to B&amp;W)).
          Should apply to most highlighting effects achieved through inversion.
          Note that if your highlighted element contains text,
          you might want to keep the unhighlight refresh as <code>&quot;ui&quot;</code> instead, for crisper text.
          (Or optimize that refresh away entirely, if you can get away with it).</li>
    <li><code>a2</code>:   low fidelity refresh (e.g., monochrome content (technically, from B&amp;W to B&amp;W only)).
          Should be limited to very specific use-cases (e.g., keyboard)</li>
    <li><code>flashui</code>: like <code>ui</code>, but flashing.
             Can be used when showing a UI element for the first time, or when closing one, to avoid ghosting.</li>
    <li><code>flashpartial</code>: like <code>partial</code>, but flashing (and not counting towards flashing promotions).
                  Can be used when closing an UI element (usually over ReaderUI), to avoid ghosting.
                  You can even drop the region in these cases, to ensure a fullscreen flash.
                  NOTE: On REAGL devices, <code>flashpartial</code> will NOT actually flash (by design).
                        As such, even onCloseWidget, you might prefer <code>flashui</code> in most instances.</li>
</ul>

<p>NOTE: You'll notice a trend on UI elements that are usually shown <em>over</em> some kind of text (generally ReaderUI)
of using <code>&quot;ui&quot;</code> onShow &amp; onUpdate, but <code>&quot;partial&quot;</code> onCloseWidget.
This is by design: <code>&quot;partial&quot;</code> is what the reader (ReaderUI) uses, as it's tailor-made for pure text
over a white background, so this ensures we resume the usual flow of the reader.
The same dynamic is true for their flashing counterparts, in the rare instances we enforce flashes.
Any kind of <code>&quot;partial&quot;</code> refresh <em>will</em> count towards a flashing promotion after <code>FULL_REFRESH_COUNT</code> refreshes,
so making sure your stuff only applies to the proper region is key to avoiding spurious large black flashes.
That said, depending on your use case, using <code>&quot;ui&quot;</code> onCloseWidget can be a perfectly valid decision,
and will ensure never seeing a flash because of that widget.
Remember that the FM uses <code>&quot;ui&quot;</code>, so, if said widgets are shown over the FM,
prefer using <code>&quot;ui&quot;</code> or <code>&quot;flashui&quot;</code> onCloseWidget.</p>

<p>The final parameter (refreshdither) is an optional hint for devices with hardware dithering support that this repaint
could benefit from dithering (e.g., because it contains an image).</p>

<p>As far as the actual lifecycle of a widget goes, the rules are:</p>

<ul>
    <li>What you <a href="../modules/ui.uimanager.html#UIManager:show">show</a>, you <a href="../modules/ui.uimanager.html#UIManager:close">close</a>.</li>
    <li>If you know the dimensions of the widget (or simply of the region you want to refresh), you can pass it directly:
    <ul>
        <li>to <a href="../modules/ui.uimanager.html#UIManager:show">show</a> (as <a href="../modules/ui.uimanager.html#UIManager:show">show</a> calls <a href="../modules/ui.uimanager.html#UIManager:setDirty">setDirty</a>),</li>
        <li>to <a href="../modules/ui.uimanager.html#UIManager:close">close</a> (as <a href="../modules/ui.uimanager.html#UIManager:close">close</a> will also call <a href="../modules/ui.uimanager.html#UIManager:setDirty">setDirty</a> on the remaining dirty and visible widgets,
        and will also enqueue a refresh based on that if there are dirty widgets).</li>
    </ul></li>
    <li>Otherwise, you can use, respectively, a widget's <code>Show</code> &amp; <code>CloseWidget</code> handlers for that via <a href="../modules/ui.uimanager.html#UIManager:setDirty">setDirty</a> calls.
    This can also be useful if <em>child</em> widgets have specific needs (e.g., flashing, dithering) that they want to inject in the refresh queue.</li>
    <li>Remember that events propagate children first (in array order, starting at the top), and that if <em>any</em> event handler returns true,
    the propagation of that specific event for this widget tree stops <em>immediately</em>.
    (This generally means that, unless you know what you're doing (e.g., a widget that will <em>always</em> be used as a parent),
    you generally <em>don't</em> want to return true in <code>Show</code> or <code>CloseWidget</code> handlers).</li>
    <li>If any widget requires freeing non-Lua resources (e.g., FFI/C), having a <code>free</code> method called from its <code>CloseWidget</code> handler is ideal:
    this'll ensure that <em>any</em> widget including it will be sure that resources are freed when it (or its parent) are closed.</li>
    <li>Note that there <em>is</em> a <code>Close</code> event, but it has very specific use-cases, generally involving <em>programmatically</em> <a href="../modules/ui.uimanager.html#UIManager:close">close</a>ing a <a href="../modules/ui.uimanager.html#UIManager:show">show</a>n widget:
    <ul>
        <li>It is broadcast (e.g., sent to every widget in the window stack; the same rules about propagation apply, but only per <em>window-level widget</em>)
        at poweroff/reboot.</li>
        <li>It can also be used as a keypress handler by <a href="../modules/ui.widget.container.inputcontainer.html#">InputContainer</a>, generally bound to the Back key.</li>
    </ul></li>
</ul>

<p>Please refrain from implementing custom <code>onClose</code> methods if that's not their intended purpose ;).</p>

<p>On the subject of widgets and child widgets,
you might have noticed an unspoken convention across the codebase of widgets having a field called <code>show_parent</code>.
Since handling this is entirely at the programmer's behest, here's how we usually use it:
Basically, we cascade a field named <code>show_parent</code> to every child widget that matter
(e.g., those that serve an UI purpose, as opposed to, say, a container).
This ensures that every subwidget can reference its actual parent
(ideally, all the way to the window-level widget it belongs to, i.e., the one that was passed to <a href="../modules/ui.uimanager.html#UIManager:show">show</a>, hence the name ;)),
to, among other things, flag the right widget for repaint via <a href="../modules/ui.uimanager.html#UIManager:setDirty">setDirty</a> (c.f., those pesky debug warnings when that's done wrong ;p) when they want to request a repaint.
This is why you often see stuff doing, when instantiating a new widget, <code>FancyWidget:new{ show_parent = self.show_parent or self }</code>;
meaning, if I'm already a subwidget, cascade my parent, otherwise, it means I'm a window-level widget, so cascade myself as that widget's parent ;).</p>

<p>Another convention (that a few things rely on) is naming a (persistent) MovableContainer wrapping a full widget <code>movable</code>, accessible as an instance field.
This is useful when it's used for transparency purposes, which, e.g., <a href="../modules/ui.uimanager.html#UIManager:setDirty">setDirty</a> and <a href="../modules/ui.widget.button.html#">Button</a> rely on to handle updating translucent widgets properly,
by checking if self.show_parent.movable exists and is currently translucent ;).</p>

<p>When I mentioned passing the <em>right</em> widget to <a href="../modules/ui.uimanager.html#UIManager:setDirty">setDirty</a> earlier, what I meant is that <a href="../modules/ui.uimanager.html#UIManager:setDirty">setDirty</a> will only actually flag a widget for repaint
<em>if</em> that widget is a window-level widget (that is, a widget that was passed to <a href="../modules/ui.uimanager.html#UIManager:show">show</a> earlier and hasn't been <a href="../modules/ui.uimanager.html#UIManager:close">close</a>'d yet),
hence the <code>self.show_parent</code> convention detailed above to get at the proper widget from within a subwidget ;).
Otherwise, you'll notice in debug mode that a debug guard will shout at you if that contract is broken,
and what happens in practice is the same thing as if an explicit <code>nil</code> were passed: no widgets will actually be flagged for repaint,
and only the <em>refresh</em> matching the requested region <em>will</em> be enqueued.
This is why you'll find a number of valid use-cases for passing a <code>nil</code> here, when you <em>just</em> want a screen refresh without a repaint :).
The string <code>&quot;all&quot;</code> is also accepted in place of a widget, and will do the obvious thing: flag the <em>full</em> window stack, bottom to top, for repaint,
while still honoring the refresh region (e.g., this doesn't enforce a full-screen refresh).


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">widget</span>
         a window-level widget object, <code>&quot;all&quot;</code>, or <code>nil</code>
        </li>
        <li><span class="parameter">refreshtype</span>
         <code>&quot;full&quot;</code>, <code>&quot;flashpartial&quot;</code>, <code>&quot;flashui&quot;</code>, <code>&quot;[partial]&quot;</code>, <code>&quot;[ui]&quot;</code>, <code>&quot;partial&quot;</code>, <code>&quot;ui&quot;</code>, <code>&quot;fast&quot;</code>, <code>&quot;a2&quot;</code> (or a lambda, see description above)
        </li>
        <li><span class="parameter">refreshregion</span>
         a rectangle <a href="../modules/ui.geometry.html#Geom">Geom</a> object (optional, omitting it means the region will cover the full screen)
        </li>
        <li><span class="parameter">refreshdither</span>
            <span class="types"><span class="type">boolean</span></span>
         <code>true</code> if widget requires dithering (optional)
        </li>
    </ul>




    <h3>Usage:</h3>
    <ul>
        <pre class="example">UIManager:<span class="function-name">setDirty</span>(self.widget, <span class="string">"partial"</span>)
UIManager:<span class="function-name">setDirty</span>(self.widget, <span class="string">"partial"</span>, Geom:<span class="function-name">new</span>{x=<span class="number">10</span>,y=<span class="number">10</span>,w=<span class="number">100</span>,h=<span class="number">50</span>})
UIManager:<span class="function-name">setDirty</span>(self.widget, <span class="keyword">function</span>() <span class="keyword">return</span> <span class="string">"ui"</span>, self.someelement.dimen <span class="keyword">end</span>)</pre>
    </ul>

</dd>
    <dt>
    <a name = "UIManager:clearRenderStack"></a>
    <strong>UIManager:clearRenderStack ()</strong>
    </dt>
    <dd>
    Clear the full repaint &amp; refresh queues. </p>

<p>NOTE: Beware! This doesn't take any prisonners!
You shouldn't have to resort to this unless in very specific circumstances!
plugins/coverbrowser.koplugin/covermenu.lua building a franken-menu out of buttondialog
and wanting to avoid inheriting their original paint/refresh cycle being a prime example.







</dd>
    <dt>
    <a name = "UIManager:setRefreshRate"></a>
    <strong>UIManager:setRefreshRate (rate, night_rate)</strong>
    </dt>
    <dd>
    Sets the full refresh rate for e-ink screens (<code>FULL_REFRESH_COUNT</code>). </p>

<p>This is the amount of <code>&quot;partial&quot;</code> refreshes before the next one gets promoted to <code>&quot;full&quot;</code>.</p>

<p>Also makes the refresh rate persistent in global reader settings.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">rate</span>



        </li>
        <li><span class="parameter">night_rate</span>



        </li>
    </ul>



    <h3>See also:</h3>
    <ul>
         <a href="../modules/ui.uimanager.html#UIManager:setDirty">setDirty</a>
    </ul>


</dd>
    <dt>
    <a name = "UIManager:getRefreshRate"></a>
    <strong>UIManager:getRefreshRate ()</strong>
    </dt>
    <dd>
    Returns the full refresh rate for e-ink screens (<code>FULL_REFRESH_COUNT</code>).







</dd>
    <dt>
    <a name = "UIManager:ToggleNightMode"></a>
    <strong>UIManager:ToggleNightMode (night_mode)</strong>
    </dt>
    <dd>
    Toggles Night Mode (i.e., inverted rendering).


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">night_mode</span>



        </li>
    </ul>





</dd>
    <dt>
    <a name = "UIManager:getNthTopWidget"></a>
    <strong>UIManager:getNthTopWidget (n)</strong>
    </dt>
    <dd>
    Get n.th topmost widget


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">n</span>



        </li>
    </ul>





</dd>
    <dt>
    <a name = "UIManager:topdown_widgets_iter"></a>
    <strong>UIManager:topdown_widgets_iter ()</strong>
    </dt>
    <dd>

<p>Top-to-bottom widgets iterator
 NOTE: VirtualKeyboard can be instantiated multiple times, and is a modal,</p>
<pre><code>    so don't be surprised if you find a couple of instances of it at the top ;).
</code></pre>








</dd>
    <dt>
    <a name = "UIManager:getTopmostVisibleWidget"></a>
    <strong>UIManager:getTopmostVisibleWidget ()</strong>
    </dt>
    <dd>
    Get the topmost visible widget







</dd>
    <dt>
    <a name = "UIManager:isSubwidgetShown"></a>
    <strong>UIManager:isSubwidgetShown (widget, max_depth)</strong>
    </dt>
    <dd>
    Check if a widget is still in the window stack, or is a subwidget of a widget still in the window stack.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">widget</span>



        </li>
        <li><span class="parameter">max_depth</span>



        </li>
    </ul>





</dd>
    <dt>
    <a name = "UIManager:isWidgetShown"></a>
    <strong>UIManager:isWidgetShown (widget)</strong>
    </dt>
    <dd>
    Same as <a href="../modules/ui.uimanager.html#UIManager:isSubwidgetShown">isSubwidgetShown</a>, but only check window-level widgets (e.g., what's directly registered in the window stack), don't recurse.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">widget</span>



        </li>
    </ul>





</dd>
    <dt>
    <a name = "UIManager:quit"></a>
    <strong>UIManager:quit (exit_code, implicit)</strong>
    </dt>
    <dd>
    Signals to quit.
 An exit_code of false is not allowed.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">exit_code</span>



        </li>
        <li><span class="parameter">implicit</span>



        </li>
    </ul>





</dd>
    <dt>
    <a name = "UIManager:sendEvent"></a>
    <strong>UIManager:sendEvent (event)</strong>
    </dt>
    <dd>
    Transmits an <a href="../modules/ui.event.html#Event">Event</a> to active widgets, top to bottom.
Stops at the first handler that returns <code>true</code>.
Note that most complex widgets are based on ???,
which itself will take care of propagating an event to its members.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">event</span>
         an <a href="../modules/ui.event.html#Event">Event</a> object
        </li>
    </ul>





</dd>
    <dt>
    <a name = "UIManager:broadcastEvent"></a>
    <strong>UIManager:broadcastEvent (event)</strong>
    </dt>
    <dd>
    Transmits an <a href="../modules/ui.event.html#Event">Event</a> to all registered widgets.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">event</span>
         an <a href="../modules/ui.event.html#Event">Event</a> object
        </li>
    </ul>





</dd>
    <dt>
    <a name = "UIManager:getTime"></a>
    <strong>UIManager:getTime ()</strong>
    </dt>
    <dd>
    Returns a time (fts) corresponding to the last tick. </p>

<p>This is essentially a cached time.now(), computed at the top of every iteration of the main UI loop,
(right before checking/running scheduled tasks).
This is mainly useful to compute/schedule stuff in the same time scale as the UI loop (i.e., MONOTONIC),
without having to resort to a syscall.
It should never be significantly stale, assuming the UI is in use (e.g., there are input events),
unless you're blocking the UI for a significant amount of time in a single UI frame.</p>

<p>That is to say, its granularity is an UI frame.</p>

<p>Prefer the appropriate time function for your needs if you require perfect accuracy or better granularity
(e.g., when you're actually working on the event loop <em>itself</em> (UIManager, Input, GestureDetector),
or if you're dealing with intra-frame timers).</p>

<p>This is <em>NOT</em> wall clock time (REALTIME).







</dd>
    <dt>
    <a name = "UIManager:getElapsedTimeSinceBoot"></a>
    <strong>UIManager:getElapsedTimeSinceBoot ()</strong>
    </dt>
    <dd>
    Returns a time (fts) corresponding to the last UI tick plus the time in standby.







</dd>
    <dt>
    <a name = "UIManager:forceRePaint"></a>
    <strong>UIManager:forceRePaint ()</strong>
    </dt>
    <dd>
    Explicitly drain the paint &amp; refresh queues <em>now</em>, instead of waiting for the next UI tick.







</dd>
    <dt>
    <a name = "UIManager:waitForVSync"></a>
    <strong>UIManager:waitForVSync ()</strong>
    </dt>
    <dd>
    Ask the EPDC to <em>block</em> until our previous refresh ioctl has completed. </p>

<p>This interacts sanely with the existing low-level handling of this in <code>framebuffer_mxcfb</code>
(i.e., it doesn't even try to wait for a marker that fb has already waited for, and vice-versa).</p>

<p>Will return immediately if it has already completed.</p>

<p>If the device isn't a Linux + MXCFB device, this is a NOP.







</dd>
    <dt>
    <a name = "UIManager:yieldToEPDC"></a>
    <strong>UIManager:yieldToEPDC (sleep_us)</strong>
    </dt>
    <dd>
    Yield to the EPDC. </p>

<p>This is a dumb workaround for potential races with the EPDC when we request a refresh on a specific region,
and then proceed to <em>write</em> to the framebuffer, in the same region, very, very, very soon after that.</p>

<p>This basically just puts ourselves to sleep for a very short amount of time, to let the kernel do its thing in peace.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">sleep_us</span>
            <span class="types"><span class="type">integer</span></span>
         Amount of time to sleep for (in s). (Optional, defaults to 1ms).
        </li>
    </ul>





</dd>
    <dt>
    <a name = "UIManager:widgetRepaint"></a>
    <strong>UIManager:widgetRepaint (widget, x, y)</strong>
    </dt>
    <dd>
    Used to repaint a specific sub-widget that isn't on the <code>_window_stack</code> itself. </p>

<p>Useful to avoid repainting a complex widget when we just want to invert an icon, for instance.
No safety checks on x &amp; y <em>by design</em>. I want this to blow up if used wrong.</p>

<p>This is an explicit repaint <em>now</em>: it bypasses and ignores the paint queue (unlike <a href="../modules/ui.uimanager.html#UIManager:setDirty">setDirty</a>).


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">widget</span>
         a <a href="../modules/ui.widget.widget.html#">widget</a> object
        </li>
        <li><span class="parameter">x</span>
            <span class="types"><span class="type">integer</span></span>
         left origin of widget (in the Screen buffer, e.g., <code>widget.dimen.x</code>)
        </li>
        <li><span class="parameter">y</span>
            <span class="types"><span class="type">integer</span></span>
         top origin of widget (in the Screen buffer, e.g., <code>widget.dimen.y</code>)
        </li>
    </ul>





</dd>
    <dt>
    <a name = "UIManager:widgetInvert"></a>
    <strong>UIManager:widgetInvert (widget, x, y, w, h)</strong>
    </dt>
    <dd>
    Same idea as <a href="../modules/ui.uimanager.html#UIManager:widgetRepaint">widgetRepaint</a>, but does a simple <code>bb:invertRect</code> on the Screen buffer, without actually going through the widget's <code>paintTo</code> method.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">widget</span>
         a <a href="../modules/ui.widget.widget.html#">widget</a> object
        </li>
        <li><span class="parameter">x</span>
            <span class="types"><span class="type">integer</span></span>
         left origin of the rectangle to invert (in the Screen buffer, e.g., <code>widget.dimen.x</code>)
        </li>
        <li><span class="parameter">y</span>
            <span class="types"><span class="type">integer</span></span>
         top origin of the rectangle (in the Screen buffer, e.g., <code>widget.dimen.y</code>)
        </li>
        <li><span class="parameter">w</span>
            <span class="types"><span class="type">integer</span></span>
         width of the rectangle (optional, will use <code>widget.dimen.w</code> like <code>paintTo</code> would if omitted)
        </li>
        <li><span class="parameter">h</span>
            <span class="types"><span class="type">integer</span></span>
         height of the rectangle (optional, will use <code>widget.dimen.h</code> like <code>paintTo</code> would if omitted)
        </li>
    </ul>



    <h3>See also:</h3>
    <ul>
         <a href="../modules/ui.uimanager.html#UIManager:widgetRepaint">widgetRepaint</a>
    </ul>


</dd>
    <dt>
    <a name = "UIManager:run"></a>
    <strong>UIManager:run ()</strong>
    </dt>
    <dd>
    This is the main loop of the UI controller. </p>

<p>It is intended to manage input events and delegate them to dialogs.







</dd>
    <dt>
    <a name = "UIManager:suspend"></a>
    <strong>UIManager:suspend ()</strong>
    </dt>
    <dd>
    Executes all the operations of a suspension (i.e., sleep) request. </p>

<p>This function usually puts the device into suspension.







</dd>
    <dt>
    <a name = "UIManager:allowStandby"></a>
    <strong>UIManager:allowStandby ()</strong>
    </dt>
    <dd>
    Release standby lock. </p>

<p>Called once we're done with whatever we were doing in the background.
Standby is re-enabled only after all issued prevents are paired with allowStandby for each one.







</dd>
    <dt>
    <a name = "UIManager:preventStandby"></a>
    <strong>UIManager:preventStandby ()</strong>
    </dt>
    <dd>
    Prevent standby. </p>

<p>i.e., something is happening in background, yet UI may tick.







</dd>
    <dt>
    <a name = "UIManager:flushSettings"></a>
    <strong>UIManager:flushSettings ()</strong>
    </dt>
    <dd>
    Broadcasts a <code>FlushSettings</code> Event to <em>all</em> widgets.







</dd>
    <dt>
    <a name = "UIManager:restartKOReader"></a>
    <strong>UIManager:restartKOReader ()</strong>
    </dt>
    <dd>
    Sanely restart KOReader (on supported platforms).







</dd>
    <dt>
    <a name = "UIManager:abort"></a>
    <strong>UIManager:abort ()</strong>
    </dt>
    <dd>
    Sanely abort KOReader (e.g., exit sanely, but with a non-zero return code).







</dd>
</dl>
    <h2 class="section-header "><a name="Issues"></a>Issues</h2>

    <dl class="function">
    <dt>
    <a name = "UIManager:widgetInvert-fixme7"></a>
    <strong>UIManager:widgetInvert-fixme7</strong>
    </dt>
    <dd>
    Force close looper when there is unhandled error,
 otherwise the looper will hang. Any better solution?







</dd>
</dl>


</div> <!-- id="content" -->
</div> <!-- id="main" -->
<div id="about">
<i>generated by <a href="http://github.com/lunarmodules/LDoc">LDoc 1.5.0</a></i>
<i style="float:right;">Last updated 2024-10-24 08:59:32 </i>
</div> <!-- id="about" -->
</div> <!-- id="container" -->
</body>
</html>
