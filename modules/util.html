<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<head>
    <title>KOReader Documentation</title>
    <link rel="stylesheet" href="../ldoc_fixed.css" type="text/css" />
</head>
<body>

<div id="container">

<div id="product">
	<div id="product_logo"></div>
	<div id="product_name"><big><b></b></big></div>
	<div id="product_description"></div>
</div> <!-- id="product" -->


<div id="main">


<!-- Menu -->

<div id="navigation">
<br/>
<h1>KOReader</h1>


<ul>
  <li><a href="../index.html">Index</a></li>
</ul>

<h2>Contents</h2>
<ul>
<li><a href="#Functions">Functions</a></li>
<li><a href="#Tables">Tables</a></li>
<li><a href="#Fields">Fields</a></li>
</ul>


<h2>Modules</h2>
<ul class="nowrap">
  <li><a href="../modules/android.html">android</a></li>
  <li><a href="../modules/apps.filemanager.filemanagerbookinfo.html">apps.filemanager.filemanagerbookinfo</a></li>
  <li><a href="../modules/apps.filemanager.filemanagerconverter.html">apps.filemanager.filemanagerconverter</a></li>
  <li><a href="../modules/apps.filemanager.filemanagerutil.html">apps.filemanager.filemanagerutil</a></li>
  <li><a href="../modules/apps.filemanager.lib.md.html">apps.filemanager.lib.md</a></li>
  <li><a href="../modules/apps.reader.modules.readerlink.html">apps.reader.modules.readerlink</a></li>
  <li><a href="../modules/apps.reader.modules.readerview.html">apps.reader.modules.readerview</a></li>
  <li><a href="../modules/apps.reader.readerui.html">apps.reader.readerui</a></li>
  <li><a href="../modules/baseexporter.html">baseexporter</a></li>
  <li><a href="../modules/cache.html">cache</a></li>
  <li><a href="../modules/cacheitem.html">cacheitem</a></li>
  <li><a href="../modules/datetime.html">datetime</a></li>
  <li><a href="../modules/dbg.html">dbg</a></li>
  <li><a href="../modules/depgraph.html">depgraph</a></li>
  <li><a href="../modules/device.generic.device.html">device.generic.device</a></li>
  <li><a href="../modules/device.gesturedetector.html">device.gesturedetector</a></li>
  <li><a href="../modules/device.input.html">device.input</a></li>
  <li><a href="../modules/device.kindle.mockrtc.html">device.kindle.mockrtc</a></li>
  <li><a href="../modules/device.kobo.nickel_conf.html">device.kobo.nickel_conf</a></li>
  <li><a href="../modules/device.sysfs_light.html">device.sysfs_light</a></li>
  <li><a href="../modules/device.wakeupmgr.html">device.wakeupmgr</a></li>
  <li><a href="../modules/dispatcher.html">dispatcher</a></li>
  <li><a href="../modules/docsettings.html">docsettings</a></li>
  <li><a href="../modules/document.doccache.html">document.doccache</a></li>
  <li><a href="../modules/document.documentregistry.html">document.documentregistry</a></li>
  <li><a href="../modules/document.koptinterface.html">document.koptinterface</a></li>
  <li><a href="../modules/dump.html">dump</a></li>
  <li><a href="../modules/ffi.blitbuffer.html">ffi.blitbuffer</a></li>
  <li><a href="../modules/ffi.crypto.html">ffi.crypto</a></li>
  <li><a href="../modules/ffi.framebuffer.html">ffi.framebuffer</a></li>
  <li><a href="../modules/ffi.freetype.html">ffi.freetype</a></li>
  <li><a href="../modules/ffi.jpeg.html">ffi.jpeg</a></li>
  <li><a href="../modules/ffi.koptcontext.html">ffi.koptcontext</a></li>
  <li><a href="../modules/ffi.loadlib.html">ffi.loadlib</a></li>
  <li><a href="../modules/ffi.md5.html">ffi.md5</a></li>
  <li><a href="../modules/ffi.mupdf.html">ffi.mupdf</a></li>
  <li><a href="../modules/ffi.png.html">ffi.png</a></li>
  <li><a href="../modules/ffi.rtc.html">ffi.rtc</a></li>
  <li><a href="../modules/ffi.sdl2_0.html">ffi.sdl2_0</a></li>
  <li><a href="../modules/ffi.utf8proc.html">ffi.utf8proc</a></li>
  <li><a href="../modules/ffi.util.html">ffi.util</a></li>
  <li><a href="../modules/ffi.webp.html">ffi.webp</a></li>
  <li><a href="../modules/ffi.zipwriter.html">ffi.zipwriter</a></li>
  <li><a href="../modules/ffi.zlib.html">ffi.zlib</a></li>
  <li><a href="../modules/ffi.zstd.html">ffi.zstd</a></li>
  <li><a href="../modules/gettext.html">gettext</a></li>
  <li><a href="../modules/koplugin.HelloWorld.html">koplugin.HelloWorld</a></li>
  <li><a href="../modules/koplugin.QRClipboard.html">koplugin.QRClipboard</a></li>
  <li><a href="../modules/koplugin.autodim.html">koplugin.autodim</a></li>
  <li><a href="../modules/koplugin.autowarmth.html">koplugin.autowarmth</a></li>
  <li><a href="../modules/koplugin.calibre.metadata.html">koplugin.calibre.metadata</a></li>
  <li><a href="../modules/koplugin.coverimage.html">koplugin.coverimage</a></li>
  <li><a href="../modules/koplugin.exporter.html">koplugin.exporter</a></li>
  <li><a href="../modules/koplugin.japanese.html">koplugin.japanese</a></li>
  <li><a href="../modules/koplugin.japanese.deinflector.html">koplugin.japanese.deinflector</a></li>
  <li><a href="../modules/koplugin.patchmanagement.html">koplugin.patchmanagement</a></li>
  <li><a href="../modules/koplugin.terminal.html">koplugin.terminal</a></li>
  <li><a href="../modules/koplugin.terminal.html">koplugin.terminal</a></li>
  <li><a href="../modules/koplugin.vocabbuilder.html">koplugin.vocabbuilder</a></li>
  <li><a href="../modules/koplugin.wallabag.html">koplugin.wallabag</a></li>
  <li><a href="../modules/languagesupport.html">languagesupport</a></li>
  <li><a href="../modules/logger.html">logger</a></li>
  <li><a href="../modules/luadata.html">luadata</a></li>
  <li><a href="../modules/luadefaults.html">luadefaults</a></li>
  <li><a href="../modules/luasettings.html">luasettings</a></li>
  <li><a href="../modules/optmath.html">optmath</a></li>
  <li><a href="../modules/random.html">random</a></li>
  <li><a href="../modules/socketutil.html">socketutil</a></li>
  <li><a href="../modules/sort.html">sort</a></li>
  <li><a href="../modules/suntime.html">suntime</a></li>
  <li><a href="../modules/time.html">time</a></li>
  <li><a href="../modules/ui.bidi.html">ui.bidi</a></li>
  <li><a href="../modules/ui.data.css_tweaks.html">ui.data.css_tweaks</a></li>
  <li><a href="../modules/ui.data.keyboardlayouts.generic_ime.html">ui.data.keyboardlayouts.generic_ime</a></li>
  <li><a href="../modules/ui.data.keyboardlayouts.ja_keyboard.html">ui.data.keyboardlayouts.ja_keyboard</a></li>
  <li><a href="../modules/ui.data.keyboardlayouts.ja_keyboard_keys.html">ui.data.keyboardlayouts.ja_keyboard_keys</a></li>
  <li><a href="../modules/ui.data.keyboardlayouts.ko_KR_helper.html">ui.data.keyboardlayouts.ko_KR_helper</a></li>
  <li><a href="../modules/ui.data.keyboardlayouts.zh_keyboard.html">ui.data.keyboardlayouts.zh_keyboard</a></li>
  <li><a href="../modules/ui.data.optionsutil.html">ui.data.optionsutil</a></li>
  <li><a href="../modules/ui.downloadmgr.html">ui.downloadmgr</a></li>
  <li><a href="../modules/ui.event.html">ui.event</a></li>
  <li><a href="../modules/ui.font.html">ui.font</a></li>
  <li><a href="../modules/ui.geometry.html">ui.geometry</a></li>
  <li><a href="../modules/ui.hook_container.html">ui.hook_container</a></li>
  <li><a href="../modules/ui.menusorter.html">ui.menusorter</a></li>
  <li><a href="../modules/ui.network.wpa_supplicant.html">ui.network.wpa_supplicant</a></li>
  <li><a href="../modules/ui.otamanager.html">ui.otamanager</a></li>
  <li><a href="../modules/ui.plugin.background_task_plugin.html">ui.plugin.background_task_plugin</a></li>
  <li><a href="../modules/ui.plugin.switch_plugin.html">ui.plugin.switch_plugin</a></li>
  <li><a href="../modules/ui.quickstart.html">ui.quickstart</a></li>
  <li><a href="../modules/ui.renderimage.html">ui.renderimage</a></li>
  <li><a href="../modules/ui.rendertext.html">ui.rendertext</a></li>
  <li><a href="../modules/ui.size.html">ui.size</a></li>
  <li><a href="../modules/ui.translator.html">ui.translator</a></li>
  <li><a href="../modules/ui.trapper.html">ui.trapper</a></li>
  <li><a href="../modules/ui.uimanager.html">ui.uimanager</a></li>
  <li><a href="../modules/ui.viewhtml.html">ui.viewhtml</a></li>
  <li><a href="../modules/ui.widget.bboxwidget.html">ui.widget.bboxwidget</a></li>
  <li><a href="../modules/ui.widget.button.html">ui.widget.button</a></li>
  <li><a href="../modules/ui.widget.buttondialog.html">ui.widget.buttondialog</a></li>
  <li><a href="../modules/ui.widget.checkbutton.html">ui.widget.checkbutton</a></li>
  <li><a href="../modules/ui.widget.checkmark.html">ui.widget.checkmark</a></li>
  <li><a href="../modules/ui.widget.confirmbox.html">ui.widget.confirmbox</a></li>
  <li><a href="../modules/ui.widget.container.alphacontainer.html">ui.widget.container.alphacontainer</a></li>
  <li><a href="../modules/ui.widget.container.bottomcontainer.html">ui.widget.container.bottomcontainer</a></li>
  <li><a href="../modules/ui.widget.container.centercontainer.html">ui.widget.container.centercontainer</a></li>
  <li><a href="../modules/ui.widget.container.framecontainer.html">ui.widget.container.framecontainer</a></li>
  <li><a href="../modules/ui.widget.container.inputcontainer.html">ui.widget.container.inputcontainer</a></li>
  <li><a href="../modules/ui.widget.container.leftcontainer.html">ui.widget.container.leftcontainer</a></li>
  <li><a href="../modules/ui.widget.container.movablecontainer.html">ui.widget.container.movablecontainer</a></li>
  <li><a href="../modules/ui.widget.container.rightcontainer.html">ui.widget.container.rightcontainer</a></li>
  <li><a href="../modules/ui.widget.container.scrollablecontainer.html">ui.widget.container.scrollablecontainer</a></li>
  <li><a href="../modules/ui.widget.container.topcontainer.html">ui.widget.container.topcontainer</a></li>
  <li><a href="../modules/ui.widget.container.underlinecontainer.html">ui.widget.container.underlinecontainer</a></li>
  <li><a href="../modules/ui.widget.container.widgetcontainer.html">ui.widget.container.widgetcontainer</a></li>
  <li><a href="../modules/ui.widget.datetimewidget.html">ui.widget.datetimewidget</a></li>
  <li><a href="../modules/ui.widget.eventlistener.html">ui.widget.eventlistener</a></li>
  <li><a href="../modules/ui.widget.horizontalgroup.html">ui.widget.horizontalgroup</a></li>
  <li><a href="../modules/ui.widget.htmlboxwidget.html">ui.widget.htmlboxwidget</a></li>
  <li><a href="../modules/ui.widget.iconbutton.html">ui.widget.iconbutton</a></li>
  <li><a href="../modules/ui.widget.iconwidget.html">ui.widget.iconwidget</a></li>
  <li><a href="../modules/ui.widget.imageviewer.html">ui.widget.imageviewer</a></li>
  <li><a href="../modules/ui.widget.imagewidget.html">ui.widget.imagewidget</a></li>
  <li><a href="../modules/ui.widget.infomessage.html">ui.widget.infomessage</a></li>
  <li><a href="../modules/ui.widget.inputdialog.html">ui.widget.inputdialog</a></li>
  <li><a href="../modules/ui.widget.keyboardlayoutdialog.html">ui.widget.keyboardlayoutdialog</a></li>
  <li><a href="../modules/ui.widget.keyvaluepage.html">ui.widget.keyvaluepage</a></li>
  <li><a href="../modules/ui.widget.linewidget.html">ui.widget.linewidget</a></li>
  <li><a href="../modules/ui.widget.listview.html">ui.widget.listview</a></li>
  <li><a href="../modules/ui.widget.multiconfirmbox.html">ui.widget.multiconfirmbox</a></li>
  <li><a href="../modules/ui.widget.multiinputdialog.html">ui.widget.multiinputdialog</a></li>
  <li><a href="../modules/ui.widget.networksetting.html">ui.widget.networksetting</a></li>
  <li><a href="../modules/ui.widget.notification.html">ui.widget.notification</a></li>
  <li><a href="../modules/ui.widget.numberpickerwidget.html">ui.widget.numberpickerwidget</a></li>
  <li><a href="../modules/ui.widget.openwithdialog.html">ui.widget.openwithdialog</a></li>
  <li><a href="../modules/ui.widget.overlapgroup.html">ui.widget.overlapgroup</a></li>
  <li><a href="../modules/ui.widget.progresswidget.html">ui.widget.progresswidget</a></li>
  <li><a href="../modules/ui.widget.qrmessage.html">ui.widget.qrmessage</a></li>
  <li><a href="../modules/ui.widget.radiobuttontable.html">ui.widget.radiobuttontable</a></li>
  <li><a href="../modules/ui.widget.radiobuttonwidget.html">ui.widget.radiobuttonwidget</a></li>
  <li><a href="../modules/ui.widget.scrollhtmlwidget.html">ui.widget.scrollhtmlwidget</a></li>
  <li><a href="../modules/ui.widget.scrolltextwidget.html">ui.widget.scrolltextwidget</a></li>
  <li><a href="../modules/ui.widget.textboxwidget.html">ui.widget.textboxwidget</a></li>
  <li><a href="../modules/ui.widget.textviewer.html">ui.widget.textviewer</a></li>
  <li><a href="../modules/ui.widget.textwidget.html">ui.widget.textwidget</a></li>
  <li><a href="../modules/ui.widget.toggleswitch.html">ui.widget.toggleswitch</a></li>
  <li><a href="../modules/ui.widget.touchmenu.html">ui.widget.touchmenu</a></li>
  <li><a href="../modules/ui.widget.trapwidget.html">ui.widget.trapwidget</a></li>
  <li><a href="../modules/ui.widget.verticalgroup.html">ui.widget.verticalgroup</a></li>
  <li><a href="../modules/ui.widget.widget.html">ui.widget.widget</a></li>
  <li><a href="../modules/userpatch.html">userpatch</a></li>
  <li><strong>util</strong></li>
  <li><a href="../modules/version.html">version</a></li>
</ul>
<h2>Topics</h2>
<ul class="">
  <li><a href="../topics/Collaborating_with_Git.md.html">Collaborating with Git</a></li>
  <li><a href="../topics/DataStore.md.html">DataStore</a></li>
  <li><a href="../topics/Development_guide.md.html">Development Guide</a></li>
  <li><a href="../topics/Events.md.html">Events</a></li>
  <li><a href="../topics/Hacking.md.html">Hacking</a></li>
  <li><a href="../topics/Porting.md.html">Porting</a></li>
  <li><a href="../topics/README.md.html">README</a></li>
  <li><a href="../topics/Unit_tests.md.html">Unit Tests</a></li>
</ul>

</div>

<div id="content">

<h1>Module <code>util</code></h1>
<p>This module contains miscellaneous helper functions for the KOReader frontend.</p>
<p>

</p>


<h2><a href="#Functions">Functions</a></h2>
<table class="function_list">
	<tr>
	<td class="name" nowrap><a href="#stripPunctuation">stripPunctuation (text)</a></td>
	<td class="summary">Strips all punctuation marks and spaces from a string.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#rtrim">rtrim (s)</a></td>
	<td class="summary">Remove trailing whitespace from string.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#trim">trim (s)</a></td>
	<td class="summary">Remove leading &amp; trailing whitespace from string.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#cleanupSelectedText">cleanupSelectedText (text)</a></td>
	<td class="summary">Variant tailored for text selection purposes (originally implemented in ReaderHighlight).</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#gsplit">gsplit (str, pattern, capture, capture_empty_entity)</a></td>
	<td class="summary">Splits a string by a pattern</p>

<p>Lua doesn't have a string.split() function and most of the time
you don't really need it because string.gmatch() is enough.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#tableEquals">tableEquals (o1, o2, ignore_mt)</a></td>
	<td class="summary">Compares values in two different tables.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#tableDeepCopy">tableDeepCopy (o)</a></td>
	<td class="summary">Makes a deep copy of a table.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#tableSize">tableSize (t)</a></td>
	<td class="summary">Returns number of keys in a table.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#tableGetValue">tableGetValue (t, ...)</a></td>
	<td class="summary">Returns a value of a key, checks if all parent keys are not empty.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#tableSetValue">tableSetValue (t, value, ...)</a></td>
	<td class="summary">Sets a value of a key, creates all parent keys if needed.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#tableRemoveValue">tableRemoveValue (t, ...)</a></td>
	<td class="summary">Removes a key in a table, removes all empty parent keys.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#arrayAppend">arrayAppend (t1, t2)</a></td>
	<td class="summary">Append all elements from t2 into t1.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#arrayReverse">arrayReverse (t)</a></td>
	<td class="summary">Reverse array elements in-place in table t</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#arrayContains">arrayContains (t, v, callback)</a></td>
	<td class="summary">Test whether t contains a value equal to v
 (or such a value that callback returns true),
 and if so, return the index.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#arrayReferences">arrayReferences (t, n, m)</a></td>
	<td class="summary">Test whether array t contains a reference to array n (at any depth at or below m)</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#bsearch_left">bsearch_left (array, value)</a></td>
	<td class="summary">Perform a leftmost insertion binary search for <code>value</code> in a <em>sorted</em> (ascending) <code>array</code>.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#bsearch_right">bsearch_right (array, value)</a></td>
	<td class="summary">Perform a rightmost insertion binary search for <code>value</code> in a <em>sorted</em> (ascending) <code>array</code>.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#lastIndexOf">lastIndexOf (string, ch)</a></td>
	<td class="summary">Gets last index of character in string (i.e., strrchr)</p>

<p>Returns the index within this string of the last occurrence of the specified character
or -1 if the character does not occur.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#utf8Reverse">utf8Reverse (string)</a></td>
	<td class="summary">Reverse the individual greater-than-single-byte characters</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#splitToChars">splitToChars (text)</a></td>
	<td class="summary">Splits string into a list of UTF-8 characters.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#isCJKChar">isCJKChar (c)</a></td>
	<td class="summary">Tests whether c is a CJK character</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#hasCJKChar">hasCJKChar (str)</a></td>
	<td class="summary">Tests whether str contains CJK characters</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#splitToWords">splitToWords (text)</a></td>
	<td class="summary">Split texts into a list of words, spaces and punctuation marks.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#isSplittable">isSplittable (c, next_c, prev_c)</a></td>
	<td class="summary">Test whether a string can be separated by this char for multi-line rendering.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#getFilesystemType">getFilesystemType (path)</a></td>
	<td class="summary">Gets filesystem type of a path.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#calcFreeMem">calcFreeMem ()</a></td>
	<td class="summary">Computes the currently available memory</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#findFiles">findFiles (path, callback)</a></td>
	<td class="summary">Recursively scan directory for files inside</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#isEmptyDir">isEmptyDir (path)</a></td>
	<td class="summary">Checks if directory is empty.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#fileExists">fileExists (path)</a></td>
	<td class="summary">check if the given path is a file</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#pathExists">pathExists (path)</a></td>
	<td class="summary">Checks if the given path exists.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#directoryExists">directoryExists (path)</a></td>
	<td class="summary">Checks if the given directory exists.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#makePath">makePath (path)</a></td>
	<td class="summary">As <code>mkdir -p</code>.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#removePath">removePath (path)</a></td>
	<td class="summary">Remove as many of the empty directories specified in path, children-first.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#removeFile">removeFile (path)</a></td>
	<td class="summary">As <code>rm</code></td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#getSafeFilename">getSafeFilename (str, path, limit)</a></td>
	<td class="summary">Replaces characters that are invalid in filenames.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#splitFilePathName">splitFilePathName (file)</a></td>
	<td class="summary">Splits a file into its directory path and file name.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#splitFileNameSuffix">splitFileNameSuffix (file)</a></td>
	<td class="summary">Splits a file name into its pure file name and suffix</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#getFileNameSuffix">getFileNameSuffix (filename)</a></td>
	<td class="summary">Gets file extension</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#getScriptType">getScriptType (filename)</a></td>
	<td class="summary">Companion helper function that returns the script's language,
 based on the file extension.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#getFriendlySize">getFriendlySize (size, right_align)</a></td>
	<td class="summary">Gets human friendly size as string</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#getFormattedSize">getFormattedSize (size)</a></td>
	<td class="summary">Gets formatted size as string (1273334 => "1,273,334")</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#partialMD5">partialMD5 (filepath)</a></td>
	<td class="summary">Calculate partial digest of an open file.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#fixUtf8">fixUtf8 (str, replacement)</a></td>
	<td class="summary">Replaces invalid UTF-8 characters with a replacement string.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#splitToArray">splitToArray (str, splitter, capture_empty_entity)</a></td>
	<td class="summary">Splits input string with the splitter into a table.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#unicodeCodepointToUtf8">unicodeCodepointToUtf8 (c)</a></td>
	<td class="summary">Convert a Unicode codepoint (number) to UTF-8 char
 c.f., <a href="https://stackoverflow.com/a/4609989">https://stackoverflow.com/a/4609989</a></p>
<pre><code> &amp; &lt;https://stackoverflow.com/a/38492214&gt;
</code></pre>
<p> See utf8charcode in ffi/util for a decoder.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#htmlEntitiesToUtf8">htmlEntitiesToUtf8 (string)</a></td>
	<td class="summary">Replace HTML entities with their UTF-8 encoded equivalent in text.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#htmlToPlainText">htmlToPlainText (text)</a></td>
	<td class="summary">Convert simple HTML to plain text.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#htmlToPlainTextIfHtml">htmlToPlainTextIfHtml (text)</a></td>
	<td class="summary">Convert HTML to plain text if text seems to be HTML
 Detection of HTML is simple and may raise false positives
 or negatives, but seems quite good at guessing content type
 of text found in EPUB's <dc:description>.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#htmlEscape">htmlEscape (text)</a></td>
	<td class="summary">Encode the HTML entities in a string</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#prettifyCSS">prettifyCSS (CSS)</a></td>
	<td class="summary">Prettify a CSS stylesheet
 Not perfect, but enough to make some ugly CSS readable.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#urlEncode">urlEncode (text)</a></td>
	<td class="summary">Encode URL also known as percent-encoding see https://en.wikipedia.org/wiki/Percent-encoding</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#urlDecode">urlDecode (text)</a></td>
	<td class="summary">Decode URL (reverse process to util.urlEncode())</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#checkLuaSyntax">checkLuaSyntax (text)</a></td>
	<td class="summary">Check lua syntax of string</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#stringStartsWith">stringStartsWith (str, start)</a></td>
	<td class="summary">Simple startsWith string helper.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#stringEndsWith">stringEndsWith (str, ending)</a></td>
	<td class="summary">Simple endsWith string helper.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#stringSearch">stringSearch (or, str, start_pos)</a></td>
	<td class="summary">Search a string in a text.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#wrapMethod">wrapMethod (target_table, target_field_name, new_func, before_callback)</a></td>
	<td class="summary">Wrap (or replace) a table method with a custom method, in a revertable way.</td>
	</tr>
</table>
<h2><a href="#Tables">Tables</a></h2>
<table class="function_list">
	<tr>
	<td class="name" nowrap><a href="#t">t</a></td>
	<td class="summary">Remove elements from an array, fast.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#args">args</a></td>
	<td class="summary">Escape list for shell usage</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#t">t</a></td>
	<td class="summary">Clear all the elements from an array without reassignment.</td>
	</tr>
</table>
<h2><a href="#Fields">Fields</a></h2>
<table class="function_list">
	<tr>
	<td class="name" nowrap><a href="#UTF8_CHAR_PATTERN">UTF8_CHAR_PATTERN</a></td>
	<td class="summary">Pattern which matches a single well-formed UTF-8 character, including
 theoretical >4-byte extensions.</td>
	</tr>
</table>

<br/>
<br/>


    <h2 class="section-header "><a name="Functions"></a>Functions</h2>

    <dl class="function">
    <dt>
    <a name = "stripPunctuation"></a>
    <strong>stripPunctuation (text)</strong>
    </dt>
    <dd>
    Strips all punctuation marks and spaces from a string.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">text</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         the string to be stripped
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        stripped text
    </ol>




</dd>
    <dt>
    <a name = "rtrim"></a>
    <strong>rtrim (s)</strong>
    </dt>
    <dd>
    Remove trailing whitespace from string.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">s</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         the string to be trimmed
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        trimmed text
    </ol>




</dd>
    <dt>
    <a name = "trim"></a>
    <strong>trim (s)</strong>
    </dt>
    <dd>
    Remove leading &amp; trailing whitespace from string.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">s</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         the string to be trimmed
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        trimmed text
    </ol>




</dd>
    <dt>
    <a name = "cleanupSelectedText"></a>
    <strong>cleanupSelectedText (text)</strong>
    </dt>
    <dd>
    Variant tailored for text selection purposes (originally implemented in ReaderHighlight).


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">text</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         the text to be trimmed
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        trimmed text
    </ol>




</dd>
    <dt>
    <a name = "gsplit"></a>
    <strong>gsplit (str, pattern, capture, capture_empty_entity)</strong>
    </dt>
    <dd>
    Splits a string by a pattern</p>

<p>Lua doesn't have a string.split() function and most of the time
you don't really need it because string.gmatch() is enough.
However string.gmatch() has one significant disadvantage for me:
You can't split a string while matching both the delimited
strings and the delimiters themselves without tracking positions
and substrings. The gsplit function below takes care of
this problem.</p>

<p>Author: Peter Odding</p>

<p>License: MIT/X11</p>

<p>Source: <a href="http://snippets.luacode.org/snippets/String_splitting_130">http://snippets.luacode.org/snippets/String<em>splitting</em>130</a>


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">str</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         string to split
        </li>
        <li><span class="parameter">pattern</span>
         the pattern to split against
        </li>
        <li><span class="parameter">capture</span>
            <span class="types"><span class="type">boolean</span></span>



        </li>
        <li><span class="parameter">capture_empty_entity</span>
            <span class="types"><span class="type">boolean</span></span>



        </li>
    </ul>





</dd>
    <dt>
    <a name = "tableEquals"></a>
    <strong>tableEquals (o1, o2, ignore_mt)</strong>
    </dt>
    <dd>
    Compares values in two different tables. </p>

<p>Source: <a href="https://stackoverflow.com/a/32660766/2470572">https://stackoverflow.com/a/32660766/2470572</a>


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">o1</span>
         Lua table
        </li>
        <li><span class="parameter">o2</span>
         Lua table
        </li>
        <li><span class="parameter">ignore_mt</span>
            <span class="types"><span class="type">boolean</span></span>



        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">boolean</span></span>



    </ol>




</dd>
    <dt>
    <a name = "tableDeepCopy"></a>
    <strong>tableDeepCopy (o)</strong>
    </dt>
    <dd>
    Makes a deep copy of a table. </p>

<p>Source: <a href="https://stackoverflow.com/a/16077650/2470572">https://stackoverflow.com/a/16077650/2470572</a>


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">o</span>
         Lua table
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">Lua</span></span>
        table
    </ol>




</dd>
    <dt>
    <a name = "tableSize"></a>
    <strong>tableSize (t)</strong>
    </dt>
    <dd>
    Returns number of keys in a table.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">t</span>
         Lua table
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">int</span></span>
        number of keys in table t
    </ol>




</dd>
    <dt>
    <a name = "tableGetValue"></a>
    <strong>tableGetValue (t, ...)</strong>
    </dt>
    <dd>
    Returns a value of a key, checks if all parent keys are not empty.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">t</span>
         Lua table
        </li>
        <li><span class="parameter">...</span>
         parent keys, starting from the upper level
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">value</span></span>
        of the last key or nil
    </ol>




</dd>
    <dt>
    <a name = "tableSetValue"></a>
    <strong>tableSetValue (t, value, ...)</strong>
    </dt>
    <dd>
    Sets a value of a key, creates all parent keys if needed.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">t</span>
         Lua table
        </li>
        <li><span class="parameter">value</span>
         value to be assigned to the last key
        </li>
        <li><span class="parameter">...</span>
         parent keys, starting from the upper level
        </li>
    </ul>





</dd>
    <dt>
    <a name = "tableRemoveValue"></a>
    <strong>tableRemoveValue (t, ...)</strong>
    </dt>
    <dd>
    Removes a key in a table, removes all empty parent keys.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">t</span>
         Lua table
        </li>
        <li><span class="parameter">...</span>
         parent keys, starting from the upper level
        </li>
    </ul>





</dd>
    <dt>
    <a name = "arrayAppend"></a>
    <strong>arrayAppend (t1, t2)</strong>
    </dt>
    <dd>
    Append all elements from t2 into t1.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">t1</span>
         Lua table
        </li>
        <li><span class="parameter">t2</span>
         Lua table
        </li>
    </ul>





</dd>
    <dt>
    <a name = "arrayReverse"></a>
    <strong>arrayReverse (t)</strong>
    </dt>
    <dd>
    Reverse array elements in-place in table t


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">t</span>
         Lua table
        </li>
    </ul>





</dd>
    <dt>
    <a name = "arrayContains"></a>
    <strong>arrayContains (t, v, callback)</strong>
    </dt>
    <dd>
    Test whether t contains a value equal to v
 (or such a value that callback returns true),
 and if so, return the index.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">t</span>
         Lua table
        </li>
        <li><span class="parameter">v</span>



        </li>
        <li><span class="parameter">callback</span>
            <span class="types"><span class="type">function</span></span>
        (v1, v2)
        </li>
    </ul>





</dd>
    <dt>
    <a name = "arrayReferences"></a>
    <strong>arrayReferences (t, n, m)</strong>
    </dt>
    <dd>
    Test whether array t contains a reference to array n (at any depth at or below m)


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">t</span>
         Lua table (array only)
        </li>
        <li><span class="parameter">n</span>
         Lua table (array only)
        </li>
        <li><span class="parameter">m</span>
            <span class="types"><span class="type">integer</span></span>
         Max nesting level
        </li>
    </ul>





</dd>
    <dt>
    <a name = "bsearch_left"></a>
    <strong>bsearch_left (array, value)</strong>
    </dt>
    <dd>
    Perform a leftmost insertion binary search for <code>value</code> in a <em>sorted</em> (ascending) <code>array</code>.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">array</span>
         Lua table (array only, sorted, ascending, every value must match the type of <code>value</code> and support comparison operators)
        </li>
        <li><span class="parameter">value</span>



        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

        int leftmost insertion index of value in array.
    </ol>




</dd>
    <dt>
    <a name = "bsearch_right"></a>
    <strong>bsearch_right (array, value)</strong>
    </dt>
    <dd>
    Perform a rightmost insertion binary search for <code>value</code> in a <em>sorted</em> (ascending) <code>array</code>.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">array</span>
         Lua table (array only, sorted, ascending, every value must match the type of <code>value</code> and support comparison operators)
        </li>
        <li><span class="parameter">value</span>



        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

        int rightmost insertion index of value in array.
    </ol>




</dd>
    <dt>
    <a name = "lastIndexOf"></a>
    <strong>lastIndexOf (string, ch)</strong>
    </dt>
    <dd>
    Gets last index of character in string (i.e., strrchr)</p>

<p>Returns the index within this string of the last occurrence of the specified character
or -1 if the character does not occur. </p>

<p>To find . you need to escape it.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">string</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>



        </li>
        <li><span class="parameter">ch</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>



        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">int</span></span>
        last occurrence or -1 if not found
    </ol>




</dd>
    <dt>
    <a name = "utf8Reverse"></a>
    <strong>utf8Reverse (string)</strong>
    </dt>
    <dd>
    Reverse the individual greater-than-single-byte characters


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">string</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         to reverse
 Taken from <a href="https://github.com/blitmap/lua-utf8-simple#utf8reverses">https://github.com/blitmap/lua-utf8-simple#utf8reverses</a>
        </li>
    </ul>





</dd>
    <dt>
    <a name = "splitToChars"></a>
    <strong>splitToChars (text)</strong>
    </dt>
    <dd>
    Splits string into a list of UTF-8 characters.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">text</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         the string to be split.
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.5">table</a></span>
        list of UTF-8 chars
    </ol>




</dd>
    <dt>
    <a name = "isCJKChar"></a>
    <strong>isCJKChar (c)</strong>
    </dt>
    <dd>
    Tests whether c is a CJK character


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">c</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>



        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">boolean</span></span>
        true if CJK
    </ol>




</dd>
    <dt>
    <a name = "hasCJKChar"></a>
    <strong>hasCJKChar (str)</strong>
    </dt>
    <dd>
    Tests whether str contains CJK characters


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">str</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>



        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">boolean</span></span>
        true if CJK
    </ol>




</dd>
    <dt>
    <a name = "splitToWords"></a>
    <strong>splitToWords (text)</strong>
    </dt>
    <dd>
    Split texts into a list of words, spaces and punctuation marks.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">text</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         text to split
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.5">table</a></span>
        list of words, spaces and punctuation marks
    </ol>




</dd>
    <dt>
    <a name = "isSplittable"></a>
    <strong>isSplittable (c, next_c, prev_c)</strong>
    </dt>
    <dd>
    Test whether a string can be separated by this char for multi-line rendering.
 Optional next or prev chars may be provided to help make the decision


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">c</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>



        </li>
        <li><span class="parameter">next_c</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>



        </li>
        <li><span class="parameter">prev_c</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>



        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">boolean</span></span>
        true if splittable, false if not
    </ol>




</dd>
    <dt>
    <a name = "getFilesystemType"></a>
    <strong>getFilesystemType (path)</strong>
    </dt>
    <dd>
    Gets filesystem type of a path. </p>

<p> Checks if the path occurs in <code>/proc/mounts</code>


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">path</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         an absolute path
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        filesystem type
    </ol>




</dd>
    <dt>
    <a name = "calcFreeMem"></a>
    <strong>calcFreeMem ()</strong>
    </dt>
    <dd>
    Computes the currently available memory



    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">tuple</span></span>
        of ints: memavailable, memtotal (or nil, nil on unsupported platforms).
    </ol>




</dd>
    <dt>
    <a name = "findFiles"></a>
    <strong>findFiles (path, callback)</strong>
    </dt>
    <dd>
    Recursively scan directory for files inside


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">path</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>



        </li>
        <li><span class="parameter">callback</span>
            <span class="types"><span class="type">function</span></span>
        (fullpath, name, attr)
        </li>
    </ul>





</dd>
    <dt>
    <a name = "isEmptyDir"></a>
    <strong>isEmptyDir (path)</strong>
    </dt>
    <dd>
    Checks if directory is empty.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">path</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>



        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">bool</span></span>



    </ol>




</dd>
    <dt>
    <a name = "fileExists"></a>
    <strong>fileExists (path)</strong>
    </dt>
    <dd>
    check if the given path is a file


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">path</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>



        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">bool</span></span>



    </ol>




</dd>
    <dt>
    <a name = "pathExists"></a>
    <strong>pathExists (path)</strong>
    </dt>
    <dd>
    Checks if the given path exists.  Doesn't care if it's a file or directory.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">path</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>



        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">bool</span></span>



    </ol>




</dd>
    <dt>
    <a name = "directoryExists"></a>
    <strong>directoryExists (path)</strong>
    </dt>
    <dd>
    Checks if the given directory exists.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">path</span>



        </li>
    </ul>





</dd>
    <dt>
    <a name = "makePath"></a>
    <strong>makePath (path)</strong>
    </dt>
    <dd>
    As <code>mkdir -p</code>.
 Unlike <a href="https://keplerproject.github.io/luafilesystem/manual.html#mkdir">lfs.mkdir</a>(),
 does not error if the directory already exists, and creates intermediate directories as needed.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">path</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         the directory to create
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">bool</span></span>
        true on success; nil, err_message on error
    </ol>




</dd>
    <dt>
    <a name = "removePath"></a>
    <strong>removePath (path)</strong>
    </dt>
    <dd>
    Remove as many of the empty directories specified in path, children-first.
 Does not fail if the directory is already gone.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">path</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         the directory tree to prune
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">bool</span></span>
        true on success; nil, err_message on error
    </ol>




</dd>
    <dt>
    <a name = "removeFile"></a>
    <strong>removeFile (path)</strong>
    </dt>
    <dd>
    As <code>rm</code>


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">path</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         of the file to remove
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">bool</span></span>
        true on success; nil, err_message on error
    </ol>




</dd>
    <dt>
    <a name = "getSafeFilename"></a>
    <strong>getSafeFilename (str, path, limit)</strong>
    </dt>
    <dd>
    Replaces characters that are invalid in filenames. </p>

<p>Replaces the characters <code>\/:*?&quot;&lt;&gt;|</code> with an <code>_</code> unless an optional path is provided. These characters are problematic on Windows filesystems. On Linux only the <code>/</code> poses a problem.</p>

<p>If an optional path is provided, <a href="../modules/util.html#getFilesystemType">util.getFilesystemType</a>() will be used to determine whether stricter VFAT restrictions should be applied.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">str</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>



        </li>
        <li><span class="parameter">path</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>



        </li>
        <li><span class="parameter">limit</span>
            <span class="types"><span class="type">integer</span></span>



        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        safe filename
    </ol>




</dd>
    <dt>
    <a name = "splitFilePathName"></a>
    <strong>splitFilePathName (file)</strong>
    </dt>
    <dd>
    Splits a file into its directory path and file name.
 If the given path has a trailing /, returns the entire path as the directory
 path and "" as the file name.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">file</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>



        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        directory, filename
    </ol>




</dd>
    <dt>
    <a name = "splitFileNameSuffix"></a>
    <strong>splitFileNameSuffix (file)</strong>
    </dt>
    <dd>
    Splits a file name into its pure file name and suffix


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">file</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>



        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        path, extension
    </ol>




</dd>
    <dt>
    <a name = "getFileNameSuffix"></a>
    <strong>getFileNameSuffix (filename)</strong>
    </dt>
    <dd>
    Gets file extension


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">filename</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>



        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        extension
    </ol>




</dd>
    <dt>
    <a name = "getScriptType"></a>
    <strong>getScriptType (filename)</strong>
    </dt>
    <dd>
    Companion helper function that returns the script's language,
 based on the file extension.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">filename</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>



        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        (lowercase) (or nil if not Device:canExecuteScript(file))
    </ol>




</dd>
    <dt>
    <a name = "getFriendlySize"></a>
    <strong>getFriendlySize (size, right_align)</strong>
    </dt>
    <dd>
    Gets human friendly size as string


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">size</span>
            <span class="types"><span class="type">integer</span></span>
         (bytes)
        </li>
        <li><span class="parameter">right_align</span>
            <span class="types"><span class="type">boolean</span></span>
         (by padding with spaces on the left)
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>



    </ol>




</dd>
    <dt>
    <a name = "getFormattedSize"></a>
    <strong>getFormattedSize (size)</strong>
    </dt>
    <dd>
    Gets formatted size as string (1273334 => "1,273,334")


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">size</span>
            <span class="types"><span class="type">integer</span></span>
         (bytes)
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>



    </ol>




</dd>
    <dt>
    <a name = "partialMD5"></a>
    <strong>partialMD5 (filepath)</strong>
    </dt>
    <dd>
    Calculate partial digest of an open file.  To the calculating mechanism itself,
 since only PDF documents could be modified by KOReader by appending data
 at the end of the files when highlighting, we use a non-even sampling
 algorithm which samples with larger weight at file head and much smaller
 weight at file tail, thus reduces the probability that appended data may change
 the digest value.
 Note that if PDF file size is around 1024, 4096, 16384, 65536, 262144
 1048576, 4194304, 16777216, 67108864, 268435456 or 1073741824, appending data
 by highlighting in KOReader may change the digest value.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">filepath</span>



        </li>
    </ul>





</dd>
    <dt>
    <a name = "fixUtf8"></a>
    <strong>fixUtf8 (str, replacement)</strong>
    </dt>
    <dd>
    Replaces invalid UTF-8 characters with a replacement string. </p>

<p>Based on <a href="http://notebook.kulchenko.com/programming/fixing-malformed-utf8-in-lua">http://notebook.kulchenko.com/programming/fixing-malformed-utf8-in-lua</a>.
c.f.,    FixUTF8 @ <a href="https://github.com/pkulchenko/ZeroBraneStudio/blob/master/src/util.lua">https://github.com/pkulchenko/ZeroBraneStudio/blob/master/src/util.lua</a>.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">str</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         the string to be checked for invalid characters
        </li>
        <li><span class="parameter">replacement</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         the string to replace invalid characters with
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        valid UTF-8
    </ol>




</dd>
    <dt>
    <a name = "splitToArray"></a>
    <strong>splitToArray (str, splitter, capture_empty_entity)</strong>
    </dt>
    <dd>
    Splits input string with the splitter into a table.  This function ignores the last empty entity.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">str</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         the string to be split
        </li>
        <li><span class="parameter">splitter</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>



        </li>
        <li><span class="parameter">capture_empty_entity</span>
            <span class="types"><span class="type">boolean</span></span>



        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">an</span></span>
        array-like table
    </ol>




</dd>
    <dt>
    <a name = "unicodeCodepointToUtf8"></a>
    <strong>unicodeCodepointToUtf8 (c)</strong>
    </dt>
    <dd>
    Convert a Unicode codepoint (number) to UTF-8 char
 c.f., <a href="https://stackoverflow.com/a/4609989">https://stackoverflow.com/a/4609989</a></p>
<pre><code> &amp; &lt;https://stackoverflow.com/a/38492214&gt;
</code></pre>
<p> See utf8charcode in ffi/util for a decoder.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">c</span>
            <span class="types"><span class="type">integer</span></span>
         Unicode codepoint
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        UTF-8 char
    </ol>




</dd>
    <dt>
    <a name = "htmlEntitiesToUtf8"></a>
    <strong>htmlEntitiesToUtf8 (string)</strong>
    </dt>
    <dd>
    Replace HTML entities with their UTF-8 encoded equivalent in text. </p>

<p>Supports only basic ones and those with numbers (no support for named entities like <code>&amp;eacute;</code>).


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">string</span>
            <span class="types"><span class="type">integer</span></span>
         text with HTML entities
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        UTF-8 text
    </ol>




</dd>
    <dt>
    <a name = "htmlToPlainText"></a>
    <strong>htmlToPlainText (text)</strong>
    </dt>
    <dd>
    Convert simple HTML to plain text. </p>

<p>This may fail on complex HTML (with styles, scripts, comments), but should be fine enough with simple HTML as found in EPUB's <code>&lt;dc:description&gt;</code>.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">text</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         HTML text
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        plain text
    </ol>




</dd>
    <dt>
    <a name = "htmlToPlainTextIfHtml"></a>
    <strong>htmlToPlainTextIfHtml (text)</strong>
    </dt>
    <dd>
    Convert HTML to plain text if text seems to be HTML
 Detection of HTML is simple and may raise false positives
 or negatives, but seems quite good at guessing content type
 of text found in EPUB's <dc:description>.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">text</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         the string with possibly some HTML
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        cleaned text
    </ol>




</dd>
    <dt>
    <a name = "htmlEscape"></a>
    <strong>htmlEscape (text)</strong>
    </dt>
    <dd>
    Encode the HTML entities in a string


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">text</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         the string to escape
 Taken from https://github.com/kernelsauce/turbo/blob/e4a35c2e3fb63f07464f8f8e17252bea3a029685/turbo/escape.lua#L58-L70
        </li>
    </ul>





</dd>
    <dt>
    <a name = "prettifyCSS"></a>
    <strong>prettifyCSS (CSS)</strong>
    </dt>
    <dd>
    Prettify a CSS stylesheet
 Not perfect, but enough to make some ugly CSS readable.
 By default, each selector and each property is put on its own line.
 With condensed=true, condense each full declaration on a single line.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">CSS</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         string
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        the CSS prettified
    </ol>




</dd>
    <dt>
    <a name = "urlEncode"></a>
    <strong>urlEncode (text)</strong>
    </dt>
    <dd>
    Encode URL also known as percent-encoding see https://en.wikipedia.org/wiki/Percent-encoding


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">text</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         the string to encode
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">encode</span></span>
        string
 Taken from https://gist.github.com/liukun/f9ce7d6d14fa45fe9b924a3eed5c3d99
    </ol>




</dd>
    <dt>
    <a name = "urlDecode"></a>
    <strong>urlDecode (text)</strong>
    </dt>
    <dd>
    Decode URL (reverse process to util.urlEncode())


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">text</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         the string to decode
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">decode</span></span>
        string
 Taken from https://gist.github.com/liukun/f9ce7d6d14fa45fe9b924a3eed5c3d99
    </ol>




</dd>
    <dt>
    <a name = "checkLuaSyntax"></a>
    <strong>checkLuaSyntax (text)</strong>
    </dt>
    <dd>
    Check lua syntax of string


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">text</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         lua code text
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        with parsing error, nil if syntax ok
    </ol>




</dd>
    <dt>
    <a name = "stringStartsWith"></a>
    <strong>stringStartsWith (str, start)</strong>
    </dt>
    <dd>
    Simple startsWith string helper. </p>

<p> C.f., <a href="http://lua-users.org/wiki/StringRecipes">http://lua-users.org/wiki/StringRecipes</a>.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">str</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         source string
        </li>
        <li><span class="parameter">start</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         string to match
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">bool</span></span>
        true on success
    </ol>




</dd>
    <dt>
    <a name = "stringEndsWith"></a>
    <strong>stringEndsWith (str, ending)</strong>
    </dt>
    <dd>
    Simple endsWith string helper.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">str</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         source string
        </li>
        <li><span class="parameter">ending</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         string to match
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">bool</span></span>
        true on success
    </ol>




</dd>
    <dt>
    <a name = "stringSearch"></a>
    <strong>stringSearch (or, str, start_pos)</strong>
    </dt>
    <dd>
    Search a string in a text.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">or</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         table txt Text (char list) to search in
        </li>
        <li><span class="parameter">str</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         String to search for
        </li>
        <li><span class="parameter">start_pos</span>
            <span class="types"><span class="type">number</span></span>
         Position number in text to start search from
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>
        <li>
           <span class="types"><span class="type">number</span></span>
        Position number or 0 if not found</li>
        <li>
           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.5">table</a></span>
        Text char list</li>
        <li>
           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.5">table</a></span>
        Search string char list</li>
    </ol>




</dd>
    <dt>
    <a name = "wrapMethod"></a>
    <strong>wrapMethod (target_table, target_field_name, new_func, before_callback)</strong>
    </dt>
    <dd>
    Wrap (or replace) a table method with a custom method, in a revertable way.
 This allows you extend the features of an existing module by modifying its
 internal methods, and then revert them back to normal later if necessary.</p>

<p> The most notable use-case for this is VirtualKeyboard's inputbox method
 wrapping to allow keyboards to add more complicated state-machines to modify
 how characters are input.</p>

<p> The returned table is the same table <code>target_table[target_field_name]</code> is
 set to. In addition to being callable, the new method has two sub-methods:</p>

<ul>
    <li><p><code>:revert()</code> will un-wrap the method and revert it to the original state.</p>

    <p>Note that if a method is wrapped multiple times, reverting it will revert
    it to the state of the method when util.wrapMethod was called (and if
    called on the table returned from util.wrapMethod, that is the state when
    that particular util.wrapMethod was called).</p></li>
    <li><p><code>:raw_call(...)</code> will call the original method with the given arguments
    and return whatever it returns.</p>

    <p>This makes it more ergonomic to use the wrapped table methods in the case
    where you've replaced the regular function with your own implementation
    but you need to call the original functions inside your implementation.</p></li>
    <li><p><code>:raw_method_call(...)</code> will call the original method with the arguments
    <code>(target_table, ...)</code> and return whatever it returns. Note that the
    target_table used is the one associated with the util.wrapMethod call.</p>

    <p>This makes it more ergonomic to use the wrapped table methods in the case
    where you've replaced the regular function with your own implementation
    but you need to call the original functions inside your implementation.</p>

    <p>This is effectively short-hand for <code>:raw_call(target_table, ...)</code>.</p></li>
</ul>

<p> This is loosely based on busted/luassert's spies implementation (MIT).
   <a href="https://github.com/Olivine-Labs/luassert/blob/v1.7.11/src/spy.lua">https://github.com/Olivine-Labs/luassert/blob/v1.7.11/src/spy.lua</a>


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">target_table</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.5">table</a></span>
         The table whose method will be wrapped.
        </li>
        <li><span class="parameter">target_field_name</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         The name of the field to wrap.
        </li>
        <li><span class="parameter">new_func</span>
            <span class="types"><span class="type">nil</span> or <span class="type">func</span></span>
         If non-nil, this function will be called instead of the original function after wrapping.
        </li>
        <li><span class="parameter">before_callback</span>
            <span class="types"><span class="type">nil</span> or <span class="type">func</span></span>
         If non-nil, this function will be called (with the arguments (target_table, ...)) before the function is called.
        </li>
    </ul>





</dd>
</dl>
    <h2 class="section-header "><a name="Tables"></a>Tables</h2>

    <dl class="function">
    <dt>
    <a name = "t"></a>
    <strong>t</strong>
    </dt>
    <dd>
    Remove elements from an array, fast. </p>

<p>Swap &amp; pop, like <a href="http://lua-users.org/lists/lua-l/2013-11/msg00027.html">http://lua-users.org/lists/lua-l/2013-11/msg00027.html</a> / <a href="https://stackoverflow.com/a/28942022">https://stackoverflow.com/a/28942022</a>, but preserving order.
c.f., <a href="https://stackoverflow.com/a/53038524">https://stackoverflow.com/a/53038524</a>


    <h3>Fields:</h3>
    <ul>
        <li><span class="parameter">keep_cb</span>
            <span class="types"><span class="type">function</span></span>
         Filtering callback. Takes three arguments: table, index, new index. Returns true to <em>keep</em> the item. See link above for potential uses of the third argument.
        </li>
    </ul>




    <h3>Usage:</h3>
    <ul>
        <pre class="example"><span class="keyword">local</span> foo = { <span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"c"</span>, <span class="string">"b"</span>, <span class="string">"d"</span>, <span class="string">"e"</span> }
<span class="keyword">local</span> <span class="keyword">function</span> <span class="function-name">drop_b</span>(t, i, j)
    <span class="comment">-- Discard any item with value "b"
</span>    <span class="keyword">return</span> t[i] ~= <span class="string">"b"</span>
<span class="keyword">end</span>
util.<span class="function-name">arrayRemove</span>(foo, drop_b)</pre>
    </ul>

</dd>
    <dt>
    <a name = "args"></a>
    <strong>args</strong>
    </dt>
    <dd>
    Escape list for shell usage







</dd>
    <dt>
    <a name = "t"></a>
    <strong>t</strong>
    </dt>
    <dd>
    Clear all the elements from an array without reassignment.







</dd>
</dl>
    <h2 class="section-header "><a name="Fields"></a>Fields</h2>

    <dl class="function">
    <dt>
    <a name = "UTF8_CHAR_PATTERN"></a>
    <strong>UTF8_CHAR_PATTERN</strong>
    </dt>
    <dd>
    Pattern which matches a single well-formed UTF-8 character, including
 theoretical >4-byte extensions.
 Taken from <a href="https://www.lua.org/manual/5.4/manual.html#pdf-utf8.charpattern">https://www.lua.org/manual/5.4/manual.html#pdf-utf8.charpattern</a>







</dd>
</dl>


</div> <!-- id="content" -->
</div> <!-- id="main" -->
<div id="about">
<i>generated by <a href="http://github.com/lunarmodules/LDoc">LDoc 1.5.0</a></i>
<i style="float:right;">Last updated 2024-10-24 08:59:32 </i>
</div> <!-- id="about" -->
</div> <!-- id="container" -->
</body>
</html>
