<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<head>
    <title>KOReader Documentation</title>
    <link rel="stylesheet" href="../ldoc_fixed.css" type="text/css" />
</head>
<body>

<div id="container">

<div id="product">
	<div id="product_logo"></div>
	<div id="product_name"><big><b></b></big></div>
	<div id="product_description"></div>
</div> <!-- id="product" -->


<div id="main">


<!-- Menu -->

<div id="navigation">
<br/>
<h1>KOReader</h1>

<ul>
  <li><a href="../index.html">Index</a></li>
</ul>

<h2>Contents</h2>
<ul>
<li><a href="#Functions">Functions</a></li>
</ul>


<h2>Modules</h2>
<ul class="nowrap">
  <li><a href="../modules/android.html">android</a></li>
  <li><a href="../modules/apps.filemanager.filemanagerbookinfo.html">apps.filemanager.filemanagerbookinfo</a></li>
  <li><a href="../modules/apps.filemanager.filemanagerconverter.html">apps.filemanager.filemanagerconverter</a></li>
  <li><a href="../modules/apps.filemanager.filemanagerutil.html">apps.filemanager.filemanagerutil</a></li>
  <li><a href="../modules/apps.filemanager.lib.md.html">apps.filemanager.lib.md</a></li>
  <li><a href="../modules/apps.reader.modules.readerlink.html">apps.reader.modules.readerlink</a></li>
  <li><a href="../modules/apps.reader.modules.readerview.html">apps.reader.modules.readerview</a></li>
  <li><a href="../modules/apps.reader.readerui.html">apps.reader.readerui</a></li>
  <li><a href="../modules/cache.html">cache</a></li>
  <li><a href="../modules/cacheitem.html">cacheitem</a></li>
  <li><a href="../modules/dbg.html">dbg</a></li>
  <li><a href="../modules/depgraph.html">depgraph</a></li>
  <li><a href="../modules/device.generic.device.html">device.generic.device</a></li>
  <li><a href="../modules/device.gesturedetector.html">device.gesturedetector</a></li>
  <li><a href="../modules/device.input.html">device.input</a></li>
  <li><a href="../modules/device.kobo.nickel_conf.html">device.kobo.nickel_conf</a></li>
  <li><a href="../modules/device.wakeupmgr.html">device.wakeupmgr</a></li>
  <li><a href="../modules/dispatcher.html">dispatcher</a></li>
  <li><a href="../modules/docsettings.html">docsettings</a></li>
  <li><a href="../modules/document.doccache.html">document.doccache</a></li>
  <li><a href="../modules/document.documentregistry.html">document.documentregistry</a></li>
  <li><a href="../modules/document.koptinterface.html">document.koptinterface</a></li>
  <li><a href="../modules/dump.html">dump</a></li>
  <li><a href="../modules/ffi.blitbuffer.html">ffi.blitbuffer</a></li>
  <li><a href="../modules/ffi.framebuffer.html">ffi.framebuffer</a></li>
  <li><a href="../modules/ffi.freetype.html">ffi.freetype</a></li>
  <li><a href="../modules/ffi.jpeg.html">ffi.jpeg</a></li>
  <li><a href="../modules/ffi.md5.html">ffi.md5</a></li>
  <li><a href="../modules/ffi.mupdf.html">ffi.mupdf</a></li>
  <li><a href="../modules/ffi.png.html">ffi.png</a></li>
  <li><a href="../modules/ffi.rtc.html">ffi.rtc</a></li>
  <li><a href="../modules/ffi.sdl2_0.html">ffi.sdl2_0</a></li>
  <li><a href="../modules/ffi.utf8proc.html">ffi.utf8proc</a></li>
  <li><a href="../modules/ffi.util.html">ffi.util</a></li>
  <li><a href="../modules/ffi.zipwriter.html">ffi.zipwriter</a></li>
  <li><a href="../modules/ffi.zlib.html">ffi.zlib</a></li>
  <li><a href="../modules/ffi.zstd.html">ffi.zstd</a></li>
  <li><a href="../modules/gettext.html">gettext</a></li>
  <li><a href="../modules/koplugin.HelloWorld.html">koplugin.HelloWorld</a></li>
  <li><a href="../modules/koplugin.QRClipboard.html">koplugin.QRClipboard</a></li>
  <li><a href="../modules/koplugin.autowarmth.html">koplugin.autowarmth</a></li>
  <li><a href="../modules/koplugin.calibre.metadata.html">koplugin.calibre.metadata</a></li>
  <li><a href="../modules/koplugin.coverimage.html">koplugin.coverimage</a></li>
  <li><a href="../modules/koplugin.japanese.html">koplugin.japanese</a></li>
  <li><a href="../modules/koplugin.japanese.deinflector.html">koplugin.japanese.deinflector</a></li>
  <li><a href="../modules/koplugin.wallabag.html">koplugin.wallabag</a></li>
  <li><a href="../modules/languagesupport.html">languagesupport</a></li>
  <li><a href="../modules/logger.html">logger</a></li>
  <li><a href="../modules/luadata.html">luadata</a></li>
  <li><a href="../modules/luasettings.html">luasettings</a></li>
  <li><a href="../modules/optmath.html">optmath</a></li>
  <li><a href="../modules/random.html">random</a></li>
  <li><a href="../modules/socketutil.html">socketutil</a></li>
  <li><a href="../modules/ui.bidi.html">ui.bidi</a></li>
  <li><a href="../modules/ui.data.css_tweaks.html">ui.data.css_tweaks</a></li>
  <li><a href="../modules/ui.data.keyboardlayouts.ko_KR_helper.html">ui.data.keyboardlayouts.ko_KR_helper</a></li>
  <li><a href="../modules/ui.data.optionsutil.html">ui.data.optionsutil</a></li>
  <li><a href="../modules/ui.downloadmgr.html">ui.downloadmgr</a></li>
  <li><a href="../modules/ui.event.html">ui.event</a></li>
  <li><a href="../modules/ui.font.html">ui.font</a></li>
  <li><a href="../modules/ui.geometry.html">ui.geometry</a></li>
  <li><a href="../modules/ui.hook_container.html">ui.hook_container</a></li>
  <li><a href="../modules/ui.menusorter.html">ui.menusorter</a></li>
  <li><a href="../modules/ui.network.wpa_supplicant.html">ui.network.wpa_supplicant</a></li>
  <li><a href="../modules/ui.otamanager.html">ui.otamanager</a></li>
  <li><a href="../modules/ui.plugin.background_task_plugin.html">ui.plugin.background_task_plugin</a></li>
  <li><a href="../modules/ui.plugin.switch_plugin.html">ui.plugin.switch_plugin</a></li>
  <li><a href="../modules/ui.quickstart.html">ui.quickstart</a></li>
  <li><a href="../modules/ui.renderimage.html">ui.renderimage</a></li>
  <li><a href="../modules/ui.rendertext.html">ui.rendertext</a></li>
  <li><a href="../modules/ui.size.html">ui.size</a></li>
  <li><a href="../modules/ui.timeval.html">ui.timeval</a></li>
  <li><a href="../modules/ui.translator.html">ui.translator</a></li>
  <li><strong>ui.trapper</strong></li>
  <li><a href="../modules/ui.uimanager.html">ui.uimanager</a></li>
  <li><a href="../modules/ui.widget.bboxwidget.html">ui.widget.bboxwidget</a></li>
  <li><a href="../modules/ui.widget.button.html">ui.widget.button</a></li>
  <li><a href="../modules/ui.widget.checkbutton.html">ui.widget.checkbutton</a></li>
  <li><a href="../modules/ui.widget.checkmark.html">ui.widget.checkmark</a></li>
  <li><a href="../modules/ui.widget.closebutton.html">ui.widget.closebutton</a></li>
  <li><a href="../modules/ui.widget.confirmbox.html">ui.widget.confirmbox</a></li>
  <li><a href="../modules/ui.widget.container.alphacontainer.html">ui.widget.container.alphacontainer</a></li>
  <li><a href="../modules/ui.widget.container.bottomcontainer.html">ui.widget.container.bottomcontainer</a></li>
  <li><a href="../modules/ui.widget.container.centercontainer.html">ui.widget.container.centercontainer</a></li>
  <li><a href="../modules/ui.widget.container.framecontainer.html">ui.widget.container.framecontainer</a></li>
  <li><a href="../modules/ui.widget.container.inputcontainer.html">ui.widget.container.inputcontainer</a></li>
  <li><a href="../modules/ui.widget.container.leftcontainer.html">ui.widget.container.leftcontainer</a></li>
  <li><a href="../modules/ui.widget.container.movablecontainer.html">ui.widget.container.movablecontainer</a></li>
  <li><a href="../modules/ui.widget.container.rightcontainer.html">ui.widget.container.rightcontainer</a></li>
  <li><a href="../modules/ui.widget.container.scrollablecontainer.html">ui.widget.container.scrollablecontainer</a></li>
  <li><a href="../modules/ui.widget.container.topcontainer.html">ui.widget.container.topcontainer</a></li>
  <li><a href="../modules/ui.widget.container.underlinecontainer.html">ui.widget.container.underlinecontainer</a></li>
  <li><a href="../modules/ui.widget.container.widgetcontainer.html">ui.widget.container.widgetcontainer</a></li>
  <li><a href="../modules/ui.widget.eventlistener.html">ui.widget.eventlistener</a></li>
  <li><a href="../modules/ui.widget.horizontalgroup.html">ui.widget.horizontalgroup</a></li>
  <li><a href="../modules/ui.widget.htmlboxwidget.html">ui.widget.htmlboxwidget</a></li>
  <li><a href="../modules/ui.widget.iconbutton.html">ui.widget.iconbutton</a></li>
  <li><a href="../modules/ui.widget.iconwidget.html">ui.widget.iconwidget</a></li>
  <li><a href="../modules/ui.widget.imageviewer.html">ui.widget.imageviewer</a></li>
  <li><a href="../modules/ui.widget.imagewidget.html">ui.widget.imagewidget</a></li>
  <li><a href="../modules/ui.widget.infomessage.html">ui.widget.infomessage</a></li>
  <li><a href="../modules/ui.widget.inputdialog.html">ui.widget.inputdialog</a></li>
  <li><a href="../modules/ui.widget.keyboardlayoutdialog.html">ui.widget.keyboardlayoutdialog</a></li>
  <li><a href="../modules/ui.widget.keyvaluepage.html">ui.widget.keyvaluepage</a></li>
  <li><a href="../modules/ui.widget.linewidget.html">ui.widget.linewidget</a></li>
  <li><a href="../modules/ui.widget.listview.html">ui.widget.listview</a></li>
  <li><a href="../modules/ui.widget.logindialog.html">ui.widget.logindialog</a></li>
  <li><a href="../modules/ui.widget.menu.html">ui.widget.menu</a></li>
  <li><a href="../modules/ui.widget.multiconfirmbox.html">ui.widget.multiconfirmbox</a></li>
  <li><a href="../modules/ui.widget.networksetting.html">ui.widget.networksetting</a></li>
  <li><a href="../modules/ui.widget.notification.html">ui.widget.notification</a></li>
  <li><a href="../modules/ui.widget.numberpickerwidget.html">ui.widget.numberpickerwidget</a></li>
  <li><a href="../modules/ui.widget.openwithdialog.html">ui.widget.openwithdialog</a></li>
  <li><a href="../modules/ui.widget.overlapgroup.html">ui.widget.overlapgroup</a></li>
  <li><a href="../modules/ui.widget.progresswidget.html">ui.widget.progresswidget</a></li>
  <li><a href="../modules/ui.widget.qrmessage.html">ui.widget.qrmessage</a></li>
  <li><a href="../modules/ui.widget.radiobutton.html">ui.widget.radiobutton</a></li>
  <li><a href="../modules/ui.widget.scrollhtmlwidget.html">ui.widget.scrollhtmlwidget</a></li>
  <li><a href="../modules/ui.widget.scrolltextwidget.html">ui.widget.scrolltextwidget</a></li>
  <li><a href="../modules/ui.widget.textboxwidget.html">ui.widget.textboxwidget</a></li>
  <li><a href="../modules/ui.widget.textviewer.html">ui.widget.textviewer</a></li>
  <li><a href="../modules/ui.widget.textwidget.html">ui.widget.textwidget</a></li>
  <li><a href="../modules/ui.widget.toggleswitch.html">ui.widget.toggleswitch</a></li>
  <li><a href="../modules/ui.widget.touchmenu.html">ui.widget.touchmenu</a></li>
  <li><a href="../modules/ui.widget.trapwidget.html">ui.widget.trapwidget</a></li>
  <li><a href="../modules/ui.widget.verticalgroup.html">ui.widget.verticalgroup</a></li>
  <li><a href="../modules/ui.widget.widget.html">ui.widget.widget</a></li>
  <li><a href="../modules/util.html">util</a></li>
  <li><a href="../modules/version.html">version</a></li>
</ul>
<h2>Topics</h2>
<ul class="">
  <li><a href="../topics/Collaborating_with_Git.md.html">Collaborating with Git</a></li>
  <li><a href="../topics/DataStore.md.html">DataStore</a></li>
  <li><a href="../topics/Development_guide.md.html">Development Guide</a></li>
  <li><a href="../topics/Events.md.html">Events</a></li>
  <li><a href="../topics/Hacking.md.html">Hacking</a></li>
  <li><a href="../topics/Porting.md.html">Porting</a></li>
  <li><a href="../topics/README.md.html">README</a></li>
  <li><a href="../topics/Unit_tests.md.html">Unit Tests</a></li>
</ul>

</div>

<div id="content">

<h1>Module <code>ui.trapper</code></h1>
<p>Trapper module: provides methods for simple interaction with UI,
without the need for explicit callbacks, for use by linear jobs
between their steps.</p>
<p>Allows code to trap UI (give progress info to UI, ask for user choice),
or get trapped by UI (get interrupted).
Mostly done with coroutines, but hides their usage for simplicity.</p>


<h2><a href="#Functions">Functions</a></h2>
<table class="function_list">
	<tr>
	<td class="name" nowrap><a href="#Trapper:wrap">Trapper:wrap (func)</a></td>
	<td class="summary">Executes a function and allows it to be trapped (that is: to use our
other methods).</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#Trapper:isWrapped">Trapper:isWrapped ()</a></td>
	<td class="summary">Returns if code is wrapped</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#Trapper:clear">Trapper:clear ()</a></td>
	<td class="summary">Clears left-over widget</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#Trapper:reset">Trapper:reset ()</a></td>
	<td class="summary">Clears left-over widget and resets Trapper state</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#Trapper:info">Trapper:info (text)</a></td>
	<td class="summary">Displays an InfoMessage, and catches dismissal.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#Trapper:setPausedText">Trapper:setPausedText (text, abort_text, continue_text)</a></td>
	<td class="summary">Overrides text and button texts on the Paused ConfirmBox.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#Trapper:confirm">Trapper:confirm (text, cancel_text, ok_text)</a></td>
	<td class="summary">Displays a ConfirmBox and gets user's choice.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#Trapper:dismissablePopen">Trapper:dismissablePopen (cmd, trap_widget_or_string)</a></td>
	<td class="summary">Dismissable wrapper for <a href="https://www.lua.org/manual/5.1/manual.html#pdf-io.popen">io.popen(<code>cmd</code>)</a>.</td>
	</tr>
	<tr>
	<td class="name" nowrap><a href="#task">task (trap_widget_or_string)</a></td>
	<td class="summary">Run a function (task) in a sub-process, allowing it to be dismissed,
and returns its return value(s).</td>
	</tr>
</table>

<br/>
<br/>


    <h2 class="section-header "><a name="Functions"></a>Functions</h2>

    <dl class="function">
    <dt>
    <a name = "Trapper:wrap"></a>
    <strong>Trapper:wrap (func)</strong>
    </dt>
    <dd>
    Executes a function and allows it to be trapped (that is: to use our
other methods). </p>

<p>Simple wrapper function for a coroutine, which is a prerequisite
for all our methods (this simply abstracts the <a href="https://www.lua.org/manual/5.1/manual.html#5.2">coroutine</a>
business to our callers), and execute it.</p>

<p>(If some code is not wrap()'ed, most of the other methods, when called,
will simply log or fallback to a non-UI action or OK choice.)</p>

<p>This call should be the last step in some event processing code,
as it may return early (the first <a href="https://www.lua.org/manual/5.1/manual.html#pdf-coroutine.yield">coroutine.yield()</a> in any of the other
methods will return from this function), and later be resumed by <a href="../modules/ui.uimanager.html#">UIManager</a>.
So any following (unwrapped) code would be then executed while <code>func</code>
is half-done, with unintended consequences.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">func</span>
         function reference to function to wrap and execute
        </li>
    </ul>





</dd>
    <dt>
    <a name = "Trapper:isWrapped"></a>
    <strong>Trapper:isWrapped ()</strong>
    </dt>
    <dd>
    Returns if code is wrapped



    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">boolean</span></span>
        true if code is wrapped by Trapper, false otherwise
    </ol>




</dd>
    <dt>
    <a name = "Trapper:clear"></a>
    <strong>Trapper:clear ()</strong>
    </dt>
    <dd>
    Clears left-over widget







</dd>
    <dt>
    <a name = "Trapper:reset"></a>
    <strong>Trapper:reset ()</strong>
    </dt>
    <dd>
    Clears left-over widget and resets Trapper state







</dd>
    <dt>
    <a name = "Trapper:info"></a>
    <strong>Trapper:info (text)</strong>
    </dt>
    <dd>
    Displays an InfoMessage, and catches dismissal. </p>

<p>Display a InfoMessage with text, or keep existing InfoMessage if text = nil,
and return true.</p>

<p>UNLESS the previous widget was itself a InfoMessage and it has been
dismissed (by Tap on the screen), in which case the new InfoMessage
is not displayed, and false is returned.</p>

<p>One can only know a InfoMessage has been dismissed when trying to
display a new one (we can't do better than that with coroutines).
So, don't hesitate to call it regularly (each call costs 100ms), between
steps of the work, to provide good responsiveness.</p>

<p>Trapper:info() is a shortcut to get dismiss info while keeping
the existing InfoMessage displayed.</p>

<p>Optional fast_refresh parameter should only be used when
displaying an InfoMessage over a previous InfoMessage of the
exact same size.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">text</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         text to display as an InfoMessage (or nil to keep existing one)
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">boolean</span></span>
        true if InfoMessage was not dismissed, false if dismissed
    </ol>



    <h3>Usage:</h3>
    <ul>
        <pre class="example">Trapper:info(<span class="string">"some text about step or progress"</span>)
go_on = Trapper:info()</pre>
    </ul>

</dd>
    <dt>
    <a name = "Trapper:setPausedText"></a>
    <strong>Trapper:setPausedText (text, abort_text, continue_text)</strong>
    </dt>
    <dd>
    Overrides text and button texts on the Paused ConfirmBox. </p>

<p>A ConfirmBox is displayed when an InfoMessage is dismissed
in Trapper:info(), with default text "Paused", and default
buttons "Abort" and "Continue".


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">text</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         ConfirmBox text (default: "Paused")
        </li>
        <li><span class="parameter">abort_text</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         ConfirmBox "Abort" button text (Trapper:info() returns false)
        </li>
        <li><span class="parameter">continue_text</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         ConfirmBox "Continue" button text
        </li>
    </ul>





</dd>
    <dt>
    <a name = "Trapper:confirm"></a>
    <strong>Trapper:confirm (text, cancel_text, ok_text)</strong>
    </dt>
    <dd>
    Displays a ConfirmBox and gets user's choice. </p>

<p>Display a ConfirmBox with the text and cancel<em>text/ok</em>text buttons,
block and wait for user's choice, and return the choice made:
false if Cancel tapped or dismissed, true if OK tapped


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">text</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         text to display in a ConfirmBox
        </li>
        <li><span class="parameter">cancel_text</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         text for ConfirmBox Cancel button
        </li>
        <li><span class="parameter">ok_text</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         text for ConfirmBox Ok button
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>

           <span class="types"><span class="type">boolean</span></span>
        false if Cancel tapped or dismissed, true if OK tapped
    </ol>



    <h3>Usage:</h3>
    <ul>
        <pre class="example">go_on = Trapper:confirm(<span class="string">"Do you want to go on?"</span>)
that_selected = Trapper:confirm(<span class="string">"Do you want to do this or that?"</span>, <span class="string">"this"</span>, <span class="string">"that"</span>))</pre>
    </ul>

</dd>
    <dt>
    <a name = "Trapper:dismissablePopen"></a>
    <strong>Trapper:dismissablePopen (cmd, trap_widget_or_string)</strong>
    </dt>
    <dd>
    Dismissable wrapper for <a href="https://www.lua.org/manual/5.1/manual.html#pdf-io.popen">io.popen(<code>cmd</code>)</a>. </p>

<p>Notes and limitations:</p>

<p>1) It is dismissable as long as <code>cmd</code> as not yet output anything.
   Once output has started, the reading will block till it is done.
   (Some shell tricks, included in <code>cmd</code>, could probably be used to
   accumulate <code>cmd</code> output in some variable, and to output the whole
   variable to stdout at the end.)</p>

<p>2) <code>cmd</code> needs to output something (we will wait till some data is available)
   If there are chances for it to not output anything, append <code>&quot;; echo&quot;</code> to <code>cmd</code></p>

<p>3) We need a <a href="../modules/ui.widget.trapwidget.html#">TrapWidget</a> or <a href="../modules/ui.widget.infomessage.html#">InfoMessage</a>,
   that, as a modal, will catch any <a href="../modules/ui.event.html#">Tap event</a> happening during
   <code>cmd</code> execution. This can be an existing already displayed widget, or
   provided as a string (a new TrapWidget will be created). If nil, true or false,
   an invisible TrapWidget will be used instead (if nil or true, the event will be
   resent; if false, the event will not be resent).</p>

<p>If we really need to have more control, we would need to use <code>select()</code> via <code>ffi</code>
or do low level non-blocking reading on the file descriptor.
If there are <code>cmd</code> that may not exit, that we would be trying to
collect indefinitely, the best option would be to compile any <code>timeout.c</code>
and use it as a wrapper.


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">cmd</span>
            <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
         shell <code>cmd</code> to execute and get output from
        </li>
        <li><span class="parameter">trap_widget_or_string</span>
         already shown widget, string, or nil, true or false
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>
        <li>
           <span class="types"><span class="type">boolean</span></span>
        completed (<code>true</code> if not interrupted, <code>false</code> if dismissed)</li>
        <li>
           <span class="types"><a class="type" href="https://www.lua.org/manual/5.1/manual.html#5.4">string</a></span>
        output of command</li>
    </ol>




</dd>
    <dt>
    <a name = "task"></a>
    <strong>task (trap_widget_or_string)</strong>
    </dt>
    <dd>
    Run a function (task) in a sub-process, allowing it to be dismissed,
and returns its return value(s). </p>

<p>Notes and limitations:</p>

<p>1) As function is run in a sub-process, it can't modify the main
   KOReader process (its parent). It has access to the state of
   KOReader at the time the sub-process was started. It should not
   use any service/driver that would make the parent process vision
   of the device state incoherent (ie: it should not use UIManager,
   display widgets, change settings, enable wifi...).
   It is allowed to modify the filesystem, as long as KOreader
   has not a cached vision of this filesystem part.
   Its returned value(s) are returned to the parent.</p>

<p>2) task may return complex data structures (but with simple lua types,
   no function) or a single string. If task returns a string or nil,
   set task<em>returns</em>simple_string to true, allowing for some
   optimisations to be made.</p>

<p>3) If dismissed, the sub-process is killed with SIGKILL, and
   task is aborted without any chance for cleanup work: use of temporary
   files should so be limited (do some cleanup of dirty files from
   previous aborted executions at the start of each new execution if
   needed), and try to keep important operations as atomic as possible.</p>

<p>4) We need a <a href="../modules/ui.widget.trapwidget.html#">TrapWidget</a> or <a href="../modules/ui.widget.infomessage.html#">InfoMessage</a>,
   that, as a modal, will catch any <a href="../modules/ui.event.html#">Tap event</a> happening during
   <code>cmd</code> execution. This can be an existing already displayed widget, or
   provided as a string (a new TrapWidget will be created). If nil, true or false,
   an invisible TrapWidget will be used instead (if nil or true, the event will be
   resent; if false, the event will not be resent).


    <h3>Parameters:</h3>
    <ul>
        <li><span class="parameter">trap_widget_or_string</span>
         already shown widget, string, or nil, true or false
        </li>
    </ul>

    <h3>Returns:</h3>
    <ol>
        <li>
           <span class="types"><span class="type">boolean</span></span>
        completed (<code>true</code> if not interrupted, <code>false</code> if dismissed)</li>
        <li>
        ... return values of task</li>
    </ol>




</dd>
</dl>


</div> <!-- id="content" -->
</div> <!-- id="main" -->
<div id="about">
<i>generated by <a href="http://github.com/stevedonovan/LDoc">LDoc 1.4.6</a></i>
<i style="float:right;">Last updated 2021-10-26 19:18:15 </i>
</div> <!-- id="about" -->
</div> <!-- id="container" -->
</body>
</html>
